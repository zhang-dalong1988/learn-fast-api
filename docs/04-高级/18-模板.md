# 模板 - FastAPI

您可以使用任何您想要的模板引擎与 FastAPI 一起使用。

一个常见的选择是 Jinja2，与 Flask 和其他工具使用的相同。

有一些工具可以轻松配置它，您可以直接在您的 FastAPI 应用程序中使用（由 Starlette 提供）。

## 安装依赖项

确保您创建了一个虚拟环境，激活它，并安装 `jinja2`：

```bash
$ pip install jinja2

---> 100%
```

## 使用 `Jinja2Templates`

- 导入 `Jinja2Templates`。
- 创建一个您可以稍后重用的 `templates` 对象。
- 在将返回模板的路径操作中声明一个 `Request` 参数。
- 使用您创建的 `templates` 来渲染并返回一个 `TemplateResponse`，传递模板的名称、请求对象和一个包含键值对的"上下文"字典，这些键值对将在 Jinja2 模板内部使用。

Python 3.8+

```python
from fastapi import FastAPI, Request
from fastapi.responses import HTMLResponse
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates

app = FastAPI()

app.mount("/static/", StaticFiles(directory="static"), name="static")

templates = Jinja2Templates(directory="templates")

@app.get("/items/{id}", response_class=HTMLResponse)
async def read_item(request: Request, id: str):
    return templates.TemplateResponse(
        request=request, name="item.html", context={"id": id}
    )
```

注意

在 FastAPI 0.108.0、Starlette 0.29.0 之前，`name` 是第一个参数。

另外，在此之前的版本中，`request` 对象是作为上下文中键值对的一部分传递给 Jinja2 的。

提示

通过声明 `response_class=HTMLResponse`，文档 UI 将能够知道响应将是 HTML。

技术细节

您也可以使用 `from starlette.templating import Jinja2Templates`。

FastAPI 提供与 `starlette.templating` 相同的 `fastapi.templating`，只是为了方便您开发者。但大多数可用的响应直接来自 Starlette。`Request` 和 `StaticFiles` 也是如此。

## 编写模板

然后您可以在 `templates/item.html` 编写一个模板，例如：

```html
<html>
<head>
    <title>Item Details</title>
    <link href="{{ url_for('static', path='/styles.css') }}" rel="stylesheet">
</head>
<body>
    <h1><a href="{{ url_for('read_item', id=id) }}">Item ID: {{ id }}</a></h1>
</body>
</html>
```

### 模板上下文值

在包含以下内容的 HTML 中：

```html
Item ID: {{ id }}
```

...它将显示从您传递的"上下文" `dict` 中获取的 `id`：

```python
{"id": id}
```

例如，对于 ID 为 `42`，这将渲染为：

```html
Item ID: 42
```

### 模板 `url_for` 参数

您还可以在模板内部使用 `url_for()`，它接受与您的路径操作函数将使用的相同参数作为参数。

因此，包含以下内容的部分：

```html
<a href="{{ url_for('read_item', id=id) }}">
```

...将生成一个链接到将由路径操作函数 `read_item(id=id)` 处理的相同 URL 的链接。

例如，对于 ID 为 `42`，这将渲染为：

```html
<a href="/items/42">
```

## 模板和静态文件

您还可以在模板内部使用 `url_for()`，并使用它，例如，与您使用 `name="static"` 挂载的 `StaticFiles` 一起使用。

```html
<html>
<head>
    <title>Item Details</title>
    <link href="{{ url_for('static', path='/styles.css') }}" rel="stylesheet">
</head>
<body>
    <h1><a href="{{ url_for('read_item', id=id) }}">Item ID: {{ id }}</a></h1>
</body>
</html>
```

在此示例中，它将链接到位于 `static/styles.css` 的 CSS 文件，内容如下：

```css
h1 {
    color: green;
}
```

并且因为您使用了 `StaticFiles`，该 CSS 文件将由您的 FastAPI 应用程序自动在 URL `/static/styles.css` 提供服务。

## 更多细节

有关更多详细信息，包括如何测试模板，请查看 Starlette 关于模板的文档。