# 请求体 - 嵌套模型

## 1. 使用列表、集合和其他类型的 Pydantic 模型

你可以将 Pydantic 模型的属性定义为其他 Pydantic 模型、列表、集合等。

```python
# 导入 FastAPI 和 BaseModel
from fastapi import FastAPI
from pydantic import BaseModel

# 创建应用实例
app = FastAPI()


# 定义 Image 数据模型
class Image(BaseModel):
    url: str  # 图片 URL
    name: str  # 图片名称


# 定义 Item 数据模型, 包含嵌套的 Image 模型
class Item(BaseModel):
    name: str  # 名称, 必填
    description: str | None = None  # 描述, 可选
    price: float  # 价格, 必填
    tax: float | None = None  # 税费, 可选
    tags: list[str] = []  # 标签列表, 默认为空列表
    image: Image | None = None  # 图片, 可选的嵌套模型


# 定义 PUT 路径操作
@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    # 返回包含 item_id 和 item 的结果
    return {"item_id": item_id, "item": item}
```

## 2. 对象列表

你也可以定义对象列表:

```python
# 导入 FastAPI 和 BaseModel
from fastapi import FastAPI
from pydantic import BaseModel

# 创建应用实例
app = FastAPI()


# 定义 Image 数据模型
class Image(BaseModel):
    url: str
    name: str


# 定义 Item 数据模型, 包含图片列表
class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []  # 标签列表
    images: list[Image] = []  # 图片列表, 嵌套模型列表


# 定义 PUT 路径操作
@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    # 返回结果
    return {"item_id": item_id, "item": item}
```

## 3. 深度嵌套模型

你可以定义任意深度的嵌套模型:

```python
# 导入必要的类
from fastapi import FastAPI
# 从 pydantic 导入 BaseModel 和 HttpUrl
from pydantic import BaseModel, HttpUrl

# 创建应用实例
app = FastAPI()


# 定义 Image 数据模型, 使用 HttpUrl 验证 URL
class Image(BaseModel):
    url: HttpUrl  # 使用 HttpUrl 进行 URL 验证
    name: str


# 定义 Item 数据模型
class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()  # 使用集合而不是列表
    images: list[Image] = []  # 图片列表


# 定义 Offer 数据模型, 包含 Item 列表
class Offer(BaseModel):
    name: str
    description: str | None = None
    price: float
    items: list[Item]  # Item 列表, 深度嵌套


# 定义 POST 路径操作
@app.post("/offers/")
async def create_offer(offer: Offer):
    # 直接返回 offer 对象
    return offer
```

## 4. 任意 `dict` 类型的请求体

你也可以将请求体声明为具有特定键和值类型的 `dict`:

```python
# 导入 FastAPI 和 BaseModel
from fastapi import FastAPI
from pydantic import BaseModel

# 创建应用实例
app = FastAPI()


# 定义 Item 数据模型
class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None


# 定义 POST 路径操作, 接收字典类型的请求体
@app.post("/index-weights/")
async def create_index_weights(weights: dict[int, float]):
    # weights 是一个字典, 键是 int 类型, 值是 float 类型
    return weights
```

## 5. 总结

你可以:

* 使用带有嵌套模型、列表、集合、字典等的 Pydantic 模型
* 声明任意深度的嵌套模型
* 为字典中的键和值使用特定类型

以及更多!
