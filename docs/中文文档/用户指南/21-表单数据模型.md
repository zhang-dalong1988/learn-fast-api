# 表单数据模型

你可以使用 __Pydantic 模型__ 在 FastAPI 中声明 __表单字段__。

注意

此功能从 FastAPI 版本 `0.113.0` 开始支持。

## 1. 表单的 Pydantic 模型

你只需要声明一个 __Pydantic 模型__, 其中包含你希望作为 __表单字段__ 接收的字段, 然后将参数声明为 `Form`:

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 使用 Annotated 声明类型为 FormData, 并使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data  # 返回接收到的表单数据
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 使用 Annotated 声明类型为 FormData, 并使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data  # 返回接收到的表单数据
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 类型为 FormData, 默认值使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: FormData = Form()):
    return data  # 返回接收到的表单数据
```

__FastAPI__ 将从请求的 __表单数据__ 中 __提取__ __每个字段__ 的数据, 并为你提供你定义的 Pydantic 模型。

## 2. 查看文档

你可以在 `/docs` 的文档 UI 中验证它:

## 3. 禁止额外字段

在某些特殊用例中 (可能不太常见), 你可能希望 __限制__ 表单字段仅限于 Pydantic 模型中声明的字段。并 __禁止__ 任何 __额外__ 字段。

注意

此功能从 FastAPI 版本 `0.114.0` 开始支持。

你可以使用 Pydantic 的模型配置来 `forbid` (禁止) 任何 `extra` (额外) 字段:

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串

    # 配置模型禁止额外的字段
    model_config = {"extra": "forbid"}


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 使用 Annotated 声明类型为 FormData, 并使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data  # 返回接收到的表单数据
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串

    # 配置模型禁止额外的字段
    model_config = {"extra": "forbid"}


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 使用 Annotated 声明类型为 FormData, 并使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: Annotated[FormData, Form()]):
    return data  # 返回接收到的表单数据
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from pydantic import BaseModel  # 导入 Pydantic 的 BaseModel

app = FastAPI()  # 创建 FastAPI 应用实例


# 定义表单数据模型, 继承自 BaseModel
class FormData(BaseModel):
    username: str  # 用户名字段, 类型为字符串
    password: str  # 密码字段, 类型为字符串

    # 配置模型禁止额外的字段
    model_config = {"extra": "forbid"}


# 定义一个 POST 路由, 路径为 /login/
# data 参数: 类型为 FormData, 默认值使用 Form() 表示这是一个表单模型
@app.post("/login/")
async def login(data: FormData = Form()):
    return data  # 返回接收到的表单数据
```

如果客户端尝试发送一些额外的数据, 它们将收到一个 __错误__ 响应。

例如, 如果客户端尝试发送表单字段:

- `username`: `Rick`
- `password`: `Portal Gun`
- `extra`: `Mr. Poopybutthole`

他们将收到一个错误响应, 告诉他们字段 `extra` 是不允许的:

```json
{
    "detail": [
        {
            "type": "extra_forbidden",
            "loc": ["body", "extra"],
            "msg": "Extra inputs are not permitted",
            "input": "Mr. Poopybutthole"
        }
    ]
}
```

## 4. 总结

你可以在 FastAPI 中使用 Pydantic 模型来声明表单字段。
