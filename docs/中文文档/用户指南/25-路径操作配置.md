# 路径操作配置

你可以将多个参数传递给你的路径操作装饰器来配置它。

警告

请注意, 这些参数是直接传递给路径操作装饰器的, 而不是传递给你的路径操作函数的。

## 1. 响应状态码

你可以定义在路径操作响应中使用的 HTTP 状态码。

你可以直接传递 int 类型的代码, 比如 `404`。

但如果你不记得每个数字代码代表什么, 你可以使用 `status` 中的快捷常量:

### 1.1 Python 3.10+

```python
# 从 fastapi 包中导入 FastAPI 和 status 模块
from fastapi import FastAPI, status
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: str | None = None  # description 字段, 可选字符串
    price: float  # price 字段, 浮点数类型
    tax: float | None = None  # tax 字段, 可选浮点数
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# status_code: 使用 status.HTTP_201_CREATED 作为状态码 (201 已创建)
@app.post(
    "/items/",
    response_model=Item,
    status_code=status.HTTP_201_CREATED,
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

### 1.2 Python 3.9+

```python
# 从 typing 中导入 Union 用于类型注解
from typing import Union

# 从 fastapi 包中导入 FastAPI 和 status 模块
from fastapi import FastAPI, status
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# status_code: 使用 status.HTTP_201_CREATED 作为状态码 (201 已创建)
@app.post(
    "/items/",
    response_model=Item,
    status_code=status.HTTP_201_CREATED,
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

### 1.3 Python 3.8+

```python
# 从 typing 中导入 Set 和 Union 用于类型注解
from typing import Set, Union

# 从 fastapi 包中导入 FastAPI 和 status 模块
from fastapi import FastAPI, status
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: Set[str] = set()  # tags 字段, 字符串集合, 默认为空集合 (使用 Set)


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# status_code: 使用 status.HTTP_201_CREATED 作为状态码 (201 已创建)
@app.post(
    "/items/",
    response_model=Item,
    status_code=status.HTTP_201_CREATED,
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

该状态码将用于响应中, 并将被添加到 OpenAPI 模式中。

技术细节

你也可以使用 `from starlette import status`。

**FastAPI** 提供与 `fastapi.status` 相同的 `starlette.status`, 只是为了方便你, 开发者。但它直接来自 Starlette。

## 2. 标签

你可以向路径操作添加标签, 传递一个 `str` 列表的参数 `tags` (通常只有一个 `str`):

### 2.1 Python 3.10+

```python
# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: str | None = None  # description 字段, 可选字符串
    price: float  # price 字段, 浮点数类型
    tax: float | None = None  # tax 字段, 可选浮点数
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# tags: 设置标签为 ["items"]
@app.post("/items/", response_model=Item, tags=["items"])
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item


# 定义一个 GET 路径操作, 读取所有 items
# tags: 设置标签为 ["items"]
@app.get("/items/", tags=["items"])
# 使用 async def 声明异步函数
async def read_items():
    # 返回 items 列表
    return [{"name": "Foo", "price": 42}]


# 定义一个 GET 路径操作, 读取所有 users
# tags: 设置标签为 ["users"]
@app.get("/users/", tags=["users"])
# 使用 async def 声明异步函数
async def read_users():
    # 返回 users 列表
    return [{"username": "johndoe"}]
```

### 2.2 Python 3.9+

```python
# 从 typing 中导入 Union 用于类型注解
from typing import Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# tags: 设置标签为 ["items"]
@app.post("/items/", response_model=Item, tags=["items"])
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item


# 定义一个 GET 路径操作, 读取所有 items
# tags: 设置标签为 ["items"]
@app.get("/items/", tags=["items"])
# 使用 async def 声明异步函数
async def read_items():
    # 返回 items 列表
    return [{"name": "Foo", "price": 42}]


# 定义一个 GET 路径操作, 读取所有 users
# tags: 设置标签为 ["users"]
@app.get("/users/", tags=["users"])
# 使用 async def 声明异步函数
async def read_users():
    # 返回 users 列表
    return [{"username": "johndoe"}]
```

### 2.3 Python 3.8+

```python
# 从 typing 中导入 Set 和 Union 用于类型注解
from typing import Set, Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: Set[str] = set()  # tags 字段, 字符串集合, 默认为空集合 (使用 Set)


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# tags: 设置标签为 ["items"]
@app.post("/items/", response_model=Item, tags=["items"])
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item


# 定义一个 GET 路径操作, 读取所有 items
# tags: 设置标签为 ["items"]
@app.get("/items/", tags=["items"])
# 使用 async def 声明异步函数
async def read_items():
    # 返回 items 列表
    return [{"name": "Foo", "price": 42}]


# 定义一个 GET 路径操作, 读取所有 users
# tags: 设置标签为 ["users"]
@app.get("/users/", tags=["users"])
# 使用 async def 声明异步函数
async def read_users():
    # 返回 users 列表
    return [{"username": "johndoe"}]
```

它们将被添加到 OpenAPI 模式中, 并由自动文档界面使用:

![Image 1](https://fastapi.tiangolo.com/img/tutorial/path-operation-configuration/image01.png)

### 2.4 使用枚举的标签

如果你有一个大型应用程序, 你最终可能会积累多个标签, 并且你希望确保始终为相关的路径操作使用相同的标签。

在这种情况下, 将标签存储在 `Enum` 中是有意义的。

**FastAPI** 以与使用普通字符串相同的方式支持它:

### 2.4.1 Python 3.8+

```python
# 从 enum 中导入 Enum
from enum import Enum

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Tags 枚举类, 继承自 Enum
class Tags(Enum):
    items = "items"  # items 标签
    users = "users"  # users 标签


# 定义一个 GET 路径操作, 获取所有 items
# tags: 使用 Tags.items 枚举值
@app.get("/items/", tags=[Tags.items])
# 使用 async def 声明异步函数
async def get_items():
    # 返回 items 列表
    return ["Portal gun", "Plumbus"]


# 定义一个 GET 路径操作, 读取所有 users
# tags: 使用 Tags.users 枚举值
@app.get("/users/", tags=[Tags.users])
# 使用 async def 声明异步函数
async def read_users():
    # 返回 users 列表
    return ["Rick", "Morty"]
```

## 3. 摘要和描述

你可以添加 `summary` 和 `description`:

### 3.1 Python 3.10+

```python
# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: str | None = None  # description 字段, 可选字符串
    price: float  # price 字段, 浮点数类型
    tax: float | None = None  # tax 字段, 可选浮点数
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# description: 操作描述, 包含所有字段信息
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    description="Create an item with all the information, name, description, price, tax and a set of unique tags",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

### 3.2 Python 3.9+

```python
# 从 typing 中导入 Union 用于类型注解
from typing import Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# description: 操作描述, 包含所有字段信息
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    description="Create an item with all the information, name, description, price, tax and a set of unique tags",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

### 3.3 Python 3.8+

```python
# 从 typing 中导入 Set 和 Union 用于类型注解
from typing import Set, Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: Set[str] = set()  # tags 字段, 字符串集合, 默认为空集合 (使用 Set)


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# description: 操作描述, 包含所有字段信息
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    description="Create an item with all the information, name, description, price, tax and a set of unique tags",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    # 返回创建的 item
    return item
```

## 4. 从文档字符串获取描述

由于描述往往很长并覆盖多行, 你可以在函数文档字符串中声明路径操作描述, **FastAPI** 将从那里读取它。

你可以在文档字符串中编写 Markdown, 它将被正确解释和显示 (考虑到文档字符串缩进)。

### 4.1 Python 3.10+

```python
# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: str | None = None  # description 字段, 可选字符串
    price: float  # price 字段, 浮点数类型
    tax: float | None = None  # tax 字段, 可选浮点数
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
@app.post("/items/", response_model=Item, summary="Create an item")
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

### 4.2 Python 3.9+

```python
# 从 typing 中导入 Union 用于类型注解
from typing import Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
@app.post("/items/", response_model=Item, summary="Create an item")
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

### 4.3 Python 3.8+

```python
# 从 typing 中导入 Set 和 Union 用于类型注解
from typing import Set, Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: Set[str] = set()  # tags 字段, 字符串集合, 默认为空集合 (使用 Set)


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
@app.post("/items/", response_model=Item, summary="Create an item")
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

它将在交互式文档中使用:

![Image 2](https://fastapi.tiangolo.com/img/tutorial/path-operation-configuration/image02.png)

## 5. 响应描述

你可以使用参数 `response_description` 指定响应描述:

### 5.1 Python 3.10+

```python
# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: str | None = None  # description 字段, 可选字符串
    price: float  # price 字段, 浮点数类型
    tax: float | None = None  # tax 字段, 可选浮点数
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# response_description: 响应描述为 "The created item"
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    response_description="The created item",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

### 5.2 Python 3.9+

```python
# 从 typing 中导入 Union 用于类型注解
from typing import Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: set[str] = set()  # tags 字段, 字符串集合, 默认为空集合


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# response_description: 响应描述为 "The created item"
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    response_description="The created item",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

### 5.3 Python 3.8+

```python
# 从 typing 中导入 Set 和 Union 用于类型注解
from typing import Set, Union

# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel
from pydantic import BaseModel

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 Item 模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # name 字段, 字符串类型
    description: Union[str, None] = None  # description 字段, 可选字符串 (使用 Union)
    price: float  # price 字段, 浮点数类型
    tax: Union[float, None] = None  # tax 字段, 可选浮点数 (使用 Union)
    tags: Set[str] = set()  # tags 字段, 字符串集合, 默认为空集合 (使用 Set)


# 定义一个 POST 路径操作, 创建 item
# response_model: 响应模型为 Item
# summary: 操作摘要为 "Create an item"
# response_description: 响应描述为 "The created item"
@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    response_description="The created item",
)
# 使用 async def 声明异步函数, 接收 Item 类型的请求体
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique tag strings for this item
    """
    # 返回创建的 item
    return item
```

提示

请注意, `response_description` 专门指的是响应, `description` 指的是一般路径操作。

检查

OpenAPI 指定每个路径操作都需要响应描述。

因此, 如果你不提供一个, **FastAPI** 将自动生成一个 "Successful response"。

![Image 3](https://fastapi.tiangolo.com/img/tutorial/path-operation-configuration/image03.png)

## 6. 弃用路径操作

如果你需要将路径操作标记为已弃用, 但不删除它, 请传递参数 `deprecated`:

### 6.1 Python 3.8+

```python
# 从 fastapi 包中导入 FastAPI
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义一个 GET 路径操作, 读取所有 items
# tags: 设置标签为 ["items"]
@app.get("/items/", tags=["items"])
# 使用 async def 声明异步函数
async def read_items():
    # 返回 items 列表
    return [{"name": "Foo", "price": 42}]


# 定义一个 GET 路径操作, 读取所有 users
# tags: 设置标签为 ["users"]
@app.get("/users/", tags=["users"])
# 使用 async def 声明异步函数
async def read_users():
    # 返回 users 列表
    return [{"username": "johndoe"}]


# 定义一个 GET 路径操作, 读取所有 elements
# tags: 设置标签为 ["items"]
# deprecated: 标记为已弃用
@app.get("/elements/", tags=["items"], deprecated=True)
# 使用 async def 声明异步函数
async def read_elements():
    # 返回 elements 列表
    return [{"item_id": "Foo"}]
```

它将在交互式文档中清楚地标记为已弃用:

![Image 4](https://fastapi.tiangolo.com/img/tutorial/path-operation-configuration/image04.png)

查看已弃用和未弃用的路径操作的外观:

![Image 5](https://fastapi.tiangolo.com/img/tutorial/path-operation-configuration/image05.png)

## 7. 总结

你可以通过向路径操作装饰器传递参数来轻松配置和添加路径操作的元数据。
