# è°ƒè¯•

ä½ å¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­è¿æ¥è°ƒè¯•å™¨, ä¾‹å¦‚ä½¿ç”¨ Visual Studio Code æˆ– PyCharmã€‚

## 1. è°ƒç”¨ `uvicorn`

åœ¨ä½ çš„ FastAPI åº”ç”¨ç¨‹åºä¸­, ç›´æ¥å¯¼å…¥å¹¶è¿è¡Œ `uvicorn`:

**Python 3.8+**

```python
# å¯¼å…¥ uvicorn
import uvicorn
# å¯¼å…¥ FastAPI
from fastapi import FastAPI

# åˆ›å»º FastAPI åº”ç”¨å®ä¾‹
app = FastAPI()

# å®šä¹‰ä¸€ä¸ªç®€å•çš„ GET è·¯å¾„æ“ä½œ
@app.get("/")
def root():
    # å®šä¹‰å˜é‡ a
    a = "a"
    # å°† b å®šä¹‰ä¸º "b" åŠ ä¸Š a
    b = "b" + a
    # è¿”å›åŒ…å« b çš„å­—å…¸
    return {"hello world": b}

# åªæœ‰å½“æ–‡ä»¶ä½œä¸ºä¸»ç¨‹åºè¿è¡Œæ—¶æ‰æ‰§è¡Œ
if __name__ == "__main__":
    # ç›´æ¥è¿è¡Œ uvicorn æœåŠ¡å™¨
    # app: FastAPI åº”ç”¨å®ä¾‹
    # host: ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)
    # port: ç«¯å£å· 8000
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### 1.1 å…³äº `__name__ == "__main__"`

`__name__ == "__main__"` çš„ä¸»è¦ç›®çš„æ˜¯è®©æŸäº›ä»£ç åœ¨æ–‡ä»¶è¢«ä»¥ä¸‹æ–¹å¼è°ƒç”¨æ—¶æ‰§è¡Œ:

```bash
$ python myapp.py
```

ä½†åœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å®ƒæ—¶ä¸ä¼šè¢«è°ƒç”¨, ä¾‹å¦‚:

```python
from myapp import app
```

#### æ›´å¤šç»†èŠ‚

å‡è®¾ä½ çš„æ–‡ä»¶åä¸º `myapp.py`ã€‚

å¦‚æœä½ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒ:

```bash
$ python myapp.py
```

é‚£ä¹ˆæ–‡ä»¶ä¸­çš„å†…éƒ¨å˜é‡ `__name__`ï¼ˆç”± Python è‡ªåŠ¨åˆ›å»ºï¼‰å°†å…·æœ‰å­—ç¬¦ä¸²å€¼ `"__main__"`ã€‚

å› æ­¤, è¿™éƒ¨åˆ†ä»£ç :

```python
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

å°†ä¼šè¿è¡Œã€‚

---

å¦‚æœä½ å¯¼å…¥è¯¥æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰, åˆ™ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

å› æ­¤, å¦‚æœä½ æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ `importer.py` åŒ…å«:

```python
from myapp import app

# å…¶ä»–ä»£ç 
```

åœ¨è¿™ç§æƒ…å†µä¸‹, `myapp.py` å†…éƒ¨è‡ªåŠ¨åˆ›å»ºçš„å˜é‡ `__name__` å°†ä¸ä¼šå…·æœ‰å€¼ `"__main__"`ã€‚

å› æ­¤, è¿™è¡Œä»£ç :

```python
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚

### ä¿¡æ¯æç¤º

æœ‰å…³æ›´å¤šä¿¡æ¯, è¯·æŸ¥çœ‹å®˜æ–¹ Python æ–‡æ¡£ã€‚

## 2. ä½¿ç”¨è°ƒè¯•å™¨è¿è¡Œä»£ç 

å› ä¸ºä½ ç›´æ¥ä»ä»£ç è¿è¡Œ Uvicorn æœåŠ¡å™¨, ä½ å¯ä»¥ç›´æ¥ä»è°ƒè¯•å™¨è°ƒç”¨ä½ çš„ Python ç¨‹åºï¼ˆä½ çš„ FastAPI åº”ç”¨ç¨‹åºï¼‰ã€‚

---

ä¾‹å¦‚, åœ¨ Visual Studio Code ä¸­, ä½ å¯ä»¥:

- è½¬åˆ° "Debug"ï¼ˆè°ƒè¯•ï¼‰é¢æ¿ã€‚
- "Add configuration..."ï¼ˆæ·»åŠ é…ç½®...ï¼‰ã€‚
- é€‰æ‹© "Python"
- ä½¿ç”¨é€‰é¡¹ "Python: Current File (Integrated Terminal)" è¿è¡Œè°ƒè¯•å™¨ã€‚

ç„¶åå®ƒå°†ä½¿ç”¨ä½ çš„ __FastAPI__ ä»£ç å¯åŠ¨æœåŠ¡å™¨, åœ¨ä½ çš„æ–­ç‚¹å¤„åœæ­¢ç­‰ã€‚

å®ƒçœ‹èµ·æ¥å¯èƒ½åƒè¿™æ ·:

![Image 1](https://fastapi.tiangolo.com/img/tutorial/debugging/image01.png)

---

å¦‚æœä½ ä½¿ç”¨ PyCharm, ä½ å¯ä»¥:

- æ‰“å¼€ "Run"ï¼ˆè¿è¡Œï¼‰èœå•ã€‚
- é€‰æ‹©é€‰é¡¹ "Debug..."ï¼ˆè°ƒè¯•...ï¼‰ã€‚
- ç„¶åä¼šæ˜¾ç¤ºä¸€ä¸ªä¸Šä¸‹æ–‡èœå•ã€‚
- é€‰æ‹©è¦è°ƒè¯•çš„æ–‡ä»¶ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹, æ˜¯ `main.py`ï¼‰ã€‚

ç„¶åå®ƒå°†ä½¿ç”¨ä½ çš„ __FastAPI__ ä»£ç å¯åŠ¨æœåŠ¡å™¨, åœ¨ä½ çš„æ–­ç‚¹å¤„åœæ­¢ç­‰ã€‚

å®ƒçœ‹èµ·æ¥å¯èƒ½åƒè¿™æ ·:

![Image 2](https://fastapi.tiangolo.com/img/tutorial/debugging/image02.png)

### 2.1 è®¾ç½®æ–­ç‚¹

åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹éå¸¸ç®€å•:

**åœ¨ Visual Studio Code ä¸­**:
- ç‚¹å‡»è¡Œå·å·¦ä¾§, å‡ºç°çº¢ç‚¹è¡¨ç¤ºæ–­ç‚¹å·²è®¾ç½®
- å½“ä»£ç è¿è¡Œåˆ°è¿™ä¸€è¡Œæ—¶ä¼šæš‚åœ

**åœ¨ PyCharm ä¸­**:
- ç‚¹å‡»è¡Œå·å·¦ä¾§, å‡ºç°çº¢ç‚¹è¡¨ç¤ºæ–­ç‚¹å·²è®¾ç½®
- å½“ä»£ç è¿è¡Œåˆ°è¿™ä¸€è¡Œæ—¶ä¼šæš‚åœ

**ç¤ºä¾‹**:

```python
import uvicorn
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def root():
    a = "a"  # â† åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
    b = "b" + a  # â† åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
    return {"hello world": b}  # â† åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### 2.2 è°ƒè¯•æŠ€å·§

ä½¿ç”¨è°ƒè¯•å™¨æ—¶, ä½ å¯ä»¥:

1. **æŸ¥çœ‹å˜é‡å€¼** - é¼ æ ‡æ‚¬åœåœ¨å˜é‡ä¸ŠæŸ¥çœ‹å½“å‰å€¼
2. **å•æ­¥æ‰§è¡Œ** - é€è¡Œæ‰§è¡Œä»£ç , æŸ¥çœ‹ç¨‹åºæµç¨‹
3. **è¿›å…¥å‡½æ•°** - æ·±å…¥åˆ°å‡½æ•°å†…éƒ¨æŸ¥çœ‹æ‰§è¡Œç»†èŠ‚
4. **è·³å‡ºå‡½æ•°** - ä»å½“å‰å‡½æ•°è¿”å›åˆ°è°ƒç”¨è€…
5. **ç»§ç»­æ‰§è¡Œ** - è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹æˆ–ç¨‹åºç»“æŸ
6. **ç›‘æ§è¡¨è¾¾å¼** - æ·»åŠ éœ€è¦ç›‘æ§çš„è¡¨è¾¾å¼, å®æ—¶æŸ¥çœ‹å…¶å€¼å˜åŒ–

### 2.3 è°ƒè¯•è·¯å¾„æ“ä½œ

å½“ä½ åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹æ—¶, æ¯æ¬¡æœ‰ HTTP è¯·æ±‚åˆ°è¾¾è¯¥è·¯å¾„, è°ƒè¯•å™¨éƒ½ä¼šæš‚åœæ‰§è¡Œ:

```python
import uvicorn
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
def read_item(item_id: int):
    # åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹, æ¯æ¬¡è¯·æ±‚ /items/{item_id} æ—¶éƒ½ä¼šæš‚åœ
    return {"item_id": item_id}

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

ç„¶åè®¿é—® `http://localhost:8000/items/42`, è°ƒè¯•å™¨ä¼šåœ¨æ–­ç‚¹å¤„æš‚åœ, ä½ å¯ä»¥æŸ¥çœ‹ `item_id` çš„å€¼ã€‚

### 2.4 è°ƒè¯•ä¾èµ–é¡¹

ä½ ä¹Ÿå¯ä»¥åœ¨ä¾èµ–é¡¹å‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹:

```python
import uvicorn
from fastapi import FastAPI, Depends

app = FastAPI()

# ä¾èµ–é¡¹å‡½æ•°
def get_query_param(q: str | None = None):
    # åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹
    return q or "default"

@app.get("/items/")
def read_items(query: str = Depends(get_query_param)):
    return {"query": query}

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

è°ƒè¯•æ—¶, ä½ å¯ä»¥çœ‹åˆ°ä¾èµ–é¡¹æ˜¯å¦‚ä½•è¢«è°ƒç”¨å’Œæ‰§è¡Œçš„ã€‚

## 3. è°ƒè¯•å¼‚æ­¥ä»£ç 

FastAPI ä½¿ç”¨ `async def` å®šä¹‰å¼‚æ­¥è·¯å¾„æ“ä½œã€‚å¤§å¤šæ•°ç°ä»£è°ƒè¯•å™¨éƒ½æ”¯æŒå¼‚æ­¥ä»£ç çš„è°ƒè¯•:

```python
import uvicorn
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    # å¼‚æ­¥å‡½æ•°ä¸­ä¹Ÿå¯ä»¥è®¾ç½®æ–­ç‚¹
    result = await some_async_function()  # è®¾ç½®æ–­ç‚¹
    return {"result": result}

async def some_async_function():
    return "async result"

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

## 4. å¸¸è§è°ƒè¯•åœºæ™¯

### 4.1 è°ƒè¯•æ•°æ®éªŒè¯é—®é¢˜

å¦‚æœä½ é‡åˆ° Pydantic éªŒè¯é—®é¢˜, å¯ä»¥åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­è®¾ç½®æ–­ç‚¹æŸ¥çœ‹æ¥æ”¶åˆ°çš„æ•°æ®:

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float

@app.post("/items/")
async def create_item(item: Item):
    # åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹, æŸ¥çœ‹ item å¯¹è±¡
    return item
```

### 4.2 è°ƒè¯•å“åº”é—®é¢˜

å¦‚æœä½ æ€€ç–‘è¿”å›çš„æ•°æ®æœ‰é—®é¢˜, åœ¨ return è¯­å¥å‰è®¾ç½®æ–­ç‚¹:

```python
@app.get("/items/{item_id}")
async def read_item(item_id: int):
    result = {"item_id": item_id, "name": "Item"}
    # åœ¨ return å‰è®¾ç½®æ–­ç‚¹, æ£€æŸ¥ result
    return result
```

### 4.3 è°ƒè¯•æ•°æ®åº“é—®é¢˜

å¦‚æœä½ ä½¿ç”¨æ•°æ®åº“ï¼ˆå¦‚ç¬¬ 32 ç« çš„ SQL æ•°æ®åº“ï¼‰, å¯ä»¥åœ¨æ•°æ®åº“æ“ä½œå‰åè®¾ç½®æ–­ç‚¹:

```python
@app.get("/items/{item_id}")
async def read_item(item_id: int, session: Session = Depends(get_session)):
    # åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹, æŸ¥çœ‹ item_id
    item = session.get(Item, item_id)
    # åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹, æŸ¥çœ‹æŸ¥è¯¢ç»“æœ
    return item
```

## 5. è°ƒè¯•æœ€ä½³å®è·µ

1. **ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å** - è®©è°ƒè¯•æ—¶æ›´å®¹æ˜“ç†è§£ä»£ç 
2. **æ·»åŠ æ—¥å¿—è¯­å¥** - åœ¨å…³é”®ä½ç½®æ·»åŠ  print æˆ– logging è¯­å¥
3. **éš”ç¦»é—®é¢˜** - ç®€åŒ–ä»£ç ä»¥å®šä½é—®é¢˜çš„æ ¹æº
4. **ä½¿ç”¨æµ‹è¯•å®¢æˆ·ç«¯** - ä½¿ç”¨ `TestClient` åœ¨æµ‹è¯•ç¯å¢ƒä¸­è°ƒè¯•
5. **æŸ¥çœ‹é”™è¯¯å †æ ˆ** - ä»”ç»†é˜…è¯»å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯

æ­å–œï¼ä½ å·²å®Œæˆäº† FastAPI Tutorialï¼ˆç”¨æˆ·æŒ‡å—ï¼‰çš„å…¨éƒ¨ 38 ç« å­¦ä¹ ï¼ğŸ‰

æ¥ä¸‹æ¥å¯ä»¥ç»§ç»­å­¦ä¹  **Advanced User Guideï¼ˆé«˜çº§æŒ‡å—ï¼‰**, æ·±å…¥äº†è§£æ›´å¤šé«˜çº§ç‰¹æ€§ã€‚
