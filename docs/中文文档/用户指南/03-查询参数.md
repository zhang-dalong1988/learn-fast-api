# 查询参数

## 1. 基本语法

当你声明不属于路径参数的其他函数参数时, 它们会被自动解释为 "查询" 参数。

```python
# 导入 FastAPI 框架
from fastapi import FastAPI

# 创建应用实例
app = FastAPI()


# 定义路径操作, 包含路径参数和查询参数
@app.get("/items/{item_id}")
async def read_item(item_id: str, name: str | None = None, age: int | None = None):
    # item_id 是路径参数
    # name 和 age 是查询参数, 都是可选的
    # 返回包含所有参数的字典
    return {"item_id": item_id, "name": name, "age": age}
```

或者使用 Python 3.8+ 的语法:

```python
# 从 typing 模块导入 Union 类型
from typing import Union
# 导入 FastAPI 框架
from fastapi import FastAPI

# 创建应用实例
app = FastAPI()


# 定义路径操作, 使用 Union 类型声明可选参数
@app.get("/items/{item_id}")
async def read_item(item_id: str, name: Union[str, None] = None, age: Union[int, None] = None):
    # 返回包含所有参数的字典
    return {"item_id": item_id, "name": name, "age": age}
```

查询是 URL 中 `?` 后面的键值对集合, 用 `&` 字符分隔。

例如, 在 URL 中:
`http://127.0.0.1:8000/items/?name=foo&age=25`

查询参数是:
- `name: foo`
- `age: 25`

FastAPI 会解析这些参数并验证类型。

## 2. 默认值

由于查询参数 `name` 和 `age` 不是路径的一部分, 它们是可选的, 可以有默认值 `None` 或任何其他默认值。

你也可以通过不设置默认值来声明它们为必需参数:

```python
# 导入 FastAPI 框架
from fastapi import FastAPI

# 创建应用实例
app = FastAPI()


# 定义路径操作, name 是必需参数, age 有默认值
@app.get("/items/{item_id}")
async def read_user(item_id: str, name: str, age: int = 0):
    # name 是必需的, 没有默认值
    # age 是可选的, 默认值为 0
    return {"item_id": item_id, "name": name, "age": age}
```

在这里, 函数参数 `name` 是必需的 (没有默认值), 而 `age` 的默认值为 `0`, 所以它是可选的。

## 3. 类型转换

FastAPI 会自动将查询参数转换为函数中声明的类型。

例如, `http://127.0.0.1:8000/items/?name=foo&age=25` 会:
- `name` 作为 `"foo"` (字符串)
- `age` 作为 `25` (整数, 不是字符串)

如果你不声明类型或将它们声明为 `str`, FastAPI 会将它们视为字符串。

## 4. 查询参数的多个值

你还可以为同一个查询参数接收多个值:

```python
# 导入 FastAPI 框架
from fastapi import FastAPI
# 从 typing 模块导入 List 类型
from typing import List

# 创建应用实例
app = FastAPI()


# 定义路径操作, short 是布尔类型查询参数
@app.get("/items/")
async def read_items(short: bool = False):
    # 定义完整结果集
    results = {
        "items": [
            {"item_id": "foo"},
            {"item_id": "bar"}
        ]
    }
    # 如果 short 为 True, 只返回部分结果
    if short:
        results = {
            "items": [
                {"item_id": "foo"}
            ]
        }
    # 返回结果
    return results
```

在这种情况下, URL 可以是:
`http://127.0.0.1:8000/items/?short=true`
或
`http://127.0.0.1:8000/items/?short=False`
或
`http://127.0.0.1:8000/items/?short=1`
或
`http://127.0.0.1:8000/items/?short=0`
甚至
`http://127.0.0.1:8000/items/?short=yes`
或
`http://127.0.0.1:8000/items/?short=no`

FastAPI 会将这些解释为布尔值。

## 5. 必需查询参数

当你声明默认值 (如 `name: str = None` 或 `age: int = 0`) 时, 参数是可选的。

如果你想让查询参数成为必需参数, 只要不声明默认值:

```python
# 导入 FastAPI 框架
from fastapi import FastAPI

# 创建应用实例
app = FastAPI()


# 定义路径操作, name 是必需的查询参数
@app.get("/items/{item_id}")
async def read_user(item_id: str, name: str):
    # item_id 是路径参数
    # name 是必需的查询参数, 没有默认值
    return {"item_id": item_id, "name": name}
```

在这里, 参数 `name` 是必需的。

如果你打开 URL:
`http://127.0.0.1:8000/items/foo`

你会得到类似这样的错误:

```json
{
    "detail": [
        {
            "loc": [
                "query",
                "name"
            ],
            "msg": "field required",
            "type": "value_error.missing"
        }
    ]
}
```

因为没有提供查询参数 `name`。

但如果你访问:
`http://127.0.0.1:8000/items/foo?name=Frank`

它会正常工作:

```json
{
    "item_id": "foo",
    "name": "Frank"
}
```

## 6. 查询参数类型转换

你还可以声明类型为 `int`, `float`, `bool` 等的查询参数。

FastAPI 会自动解析并将查询参数转换为声明的类型。

例如:
- `http://127.0.0.1:8000/items/?page=1&limit=10`
- 参数 `page` 将是 `1` (整数)
- 参数 `limit` 将是 `10` (整数)
