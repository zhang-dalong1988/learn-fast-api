# 第一步

## 1. 安装 FastAPI

首先, 你需要 Python 3.8+ 版本。

你可以使用以下命令安装 FastAPI:

```bash
# 安装 FastAPI 及其所有标准依赖 (包括 uvicorn 服务器)
pip install "fastapi[standard]"
```

这个命令会安装 FastAPI 以及所有标准依赖, 包括可以作为服务器使用的 `uvicorn`。

## 2. 创建第一个 API

创建一个名为 `main.py` 的文件:

```python
# 从 fastapi 包中导入 FastAPI 类
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义一个路径操作, 使用 GET 方法访问根路径
@app.get("/")
# 使用 async def 声明异步函数
async def root():
    # 返回一个字典作为响应
    return {"message": "Hello World"}
```

或者使用 `def` 代替 `async def`:

```python
# 从 fastapi 包中导入 FastAPI 类
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义一个路径操作, 使用 GET 方法访问根路径
@app.get("/")
# 使用 def 声明普通函数
def root():
    # 返回一个字典作为响应
    return {"message": "Hello World"}
```

## 3. 运行服务器

使用以下命令运行服务器:

```bash
# 启动 Uvicorn 服务器, 开启热重载模式
uvicorn main:app --reload
```

关于命令 `uvicorn main:app --reload` 的说明:

- `main`: 文件 `main.py` (Python "模块")
- `app`: 在 `main.py` 中用 `app = FastAPI()` 创建的对象
- `--reload`: 启用热重载, 当代码更改时服务器会自动重启

## 4. 测试 API

在浏览器中打开 http://127.0.0.1:8000

你会看到 JSON 格式的响应:

```json
{"message": "Hello World"}
```

## 5. 交互式 API 文档

现在访问 http://127.0.0.1:8000/docs

你会看到自动生成的交互式 API 文档 (由 **Swagger UI** 提供)

## 6. 备选 API 文档

现在访问 http://127.0.0.1:8000/redoc

你会看到另一种自动生成的文档 (由 **ReDoc** 提供)

## 7. OpenAPI 规范

FastAPI 使用 **OpenAPI** 标准为你的所有 API 生成"模式"

### 7.1 什么是 "模式"

"模式" 是对某事物的定义或描述, 不是实现它的代码, 而只是抽象描述。

### 7.2 API "模式"

OpenAPI 是一个规范, 规定了如何定义你的 API 模式。

模式定义了你的 API 路径, 它们接受的参数等。

### 7.3 `openapi.json`

原始 OpenAPI 模式是描述你的 API 的实际 JSON, 由 FastAPI 自动生成。

你可以在 http://127.0.0.1:8000/openapi.json 查看原始 OpenAPI 模式。

它会显示类似这样的内容:

```json
{
    "openapi": "3.1.0",
    "info": {
        "title": "FastAPI",
        "version": "0.1.0"
    },
    "paths": {
        "/": {
            "get": {
                "summary": "Root",
                "operationId": "root__get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HelloWorld"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "HelloWorld": {
                "title": "HelloWorld",
                "required": [
                    "message"
                ],
                "properties": {
                    "message": {
                        "title": "Message",
                        "type": "string"
                    }
                },
                "type": "object"
            }
        }
    }
}
```

### 7.4 用模式能做什么

模式是你的 API 的唯一真实来源。

它由 FastAPI 自动生成。

它被自动交互式文档系统使用。

它被许多其他工具使用, 例如:
- 为前端和移动端自动生成客户端代码
- 验证工具
- 以及许多其他工具

## 8. 逐步回顾

### 8.1 步骤 1: 导入 FastAPI

```python
from fastapi import FastAPI
```

`FastAPI` 是一个 Python 类, 为你的 API 提供所有功能。

### 8.2 步骤 2: 创建 FastAPI 实例

```python
app = FastAPI()
```

这个对象将是你应用程序的主要交互点。

按照约定命名为 `app`, 但你可以使用任何你喜欢的名称。

### 8.3 步骤 3: 创建路径操作

#### 路径

这里的 "路径" 是指从第一个 `/` 开始的 URL 的最后一部分。

因此, 在像这样的 URL 中:
`https://example.com/users/login`

路径就是:
`/users/login`

#### 操作

这里的 "操作" 是指 HTTP "方法" 之一。

以下之一:
- `POST`
- `GET`
- `PUT`
- `DELETE`
- ...以及更少见的:
    - `OPTIONS`
    - `HEAD`
    - `PATCH`
    - `TRACE`

在 OpenAPI 中, 这些都称为 "操作"。

我们将它们称为 "**路径操作**" 或简称 "**操作**"。

#### 定义路径操作装饰器

```python
@app.get("/")
def root():
    ...
```

`@app.get("/")` 告诉 FastAPI, 下面的函数负责处理以下请求:

- 路径为 `/`
- 使用 **get** <http://方法>

#### 路径操作函数

```python
def root():
    ...
```

- 这是我们的 "路径操作函数"
    - `def` 是 Python 中用于声明函数的关键字
    - `root` 是函数名称
    - 你可以使用任何你想要的名称
    - 函数参数放在括号内
    - 然后冒号 `:` 结束声明
    - 每当 FastAPI 收到使用 `GET` 操作访问 URL `"/"` 的请求时, 都会调用此函数

### 8.4 步骤 4: 返回内容

```python
    return {"message": "Hello World"}
```

- 你可以返回 `dict`, `list`, 单个值如 `str`, `int` 等
- 你还可以返回 Pydantic 模型
- 许多其他对象和模型也会自动转换为 JSON
- FastAPI 会使用与标准 Python `json` 库兼容的 `json.dumps()` 自动将此返回值转换为 JSON

### 8.5 步骤 5: 运行服务器

```bash
uvicorn main:app --reload
```

## 9. 升级示例

修改 `main.py` 文件, 让它从 `PUT` 请求中接收请求体。

使用 Pydantic 模型声明请求体。

```python
# 导入 typing 模块中的 Union 类型, 用于可选字段
from typing import Union
# 从 fastapi 包中导入 FastAPI 类
from fastapi import FastAPI
# 从 pydantic 中导入 BaseModel 基类
from pydantic import BaseModel


# 定义 Item 数据模型, 继承自 BaseModel
class Item(BaseModel):
    name: str  # 名称字段, 必填, 字符串类型
    description: Union[str, None] = None  # 描述字段, 可选, 字符串或 None
    price: float  # 价格字段, 必填, 浮点数类型
    tax: Union[float, None] = None  # 税费字段, 可选, 浮点数或 None


# 创建 FastAPI 应用实例
app = FastAPI()


# 定义 POST 路径操作, 接收根路径的请求
@app.post("/")
def create_item(item: Item):
    # 直接返回接收到的 item 对象
    return item
```

服务器应该会自动重载 (因为你在 `uvicorn` 命令中添加了 `--reload` 参数)。

## 10. 交互式 API 文档升级

现在访问 http://127.0.0.1:8000/docs

交互式 API 文档会自动更新, 包括新的请求体:

点击 "Try it out" 按钮, 它允许你填写参数并直接与 API 交互。

## 11. 就这些了 (暂时)

你已经看到了基本工作流程。

在接下来的教程中, 你将学习如何:

- 使用 **参数** (路径, 查询, 请求体等)
- 使用 **数据验证**
- 声明 **安全性** 和认证
- 以及更多...
