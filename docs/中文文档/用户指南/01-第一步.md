# 第一步

## 1. 安装 FastAPI

首先，你需要 Python 3.7+ 版本。

你可以使用以下命令安装 FastAPI:

```bash
# 安装 FastAPI 框架核心库
pip install fastapi
```

你还需要一个 ASGI 服务器用于生产环境，比如 **Uvicorn**。

```bash
# 安装 Uvicorn 服务器及其标准依赖
pip install "uvicorn[standard]"
```

## 2. 创建第一个 API

创建一个名为 `main.py` 的文件:

```python
# 从 fastapi 包中导入 FastAPI 类
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 定义一个路径操作，使用 GET 方法访问根路径
@app.get("/")
def read_root():
    # 返回一个字典作为响应
    return {"Hello": "World"}


# 定义一个路径操作，接受路径参数和查询参数
@app.get("/items/{item_id}")
def read_item(item_id: int, q: str = None):
    # item_id 是路径参数，必须是整数类型
    # q 是查询参数，可选，默认为 None
    return {"item_id": item_id, "q": q}
```

或者使用 `async def` 异步函数:

```python
# 从 fastapi 包中导入 FastAPI 类
from fastapi import FastAPI

# 创建 FastAPI 应用实例
app = FastAPI()


# 使用异步函数定义根路径操作
@app.get("/")
async def read_root():
    # 异步返回响应数据
    return {"Hello": "World"}


# 使用异步函数定义带参数的路径操作
@app.get("/items/{item_id}")
async def read_item(item_id: int, q: str = None):
    # 异步处理请求并返回结果
    return {"item_id": item_id, "q": q}
```

**注意**: 如果你已经了解 `async def` / `await` 的用法，可以像平常一样使用它们。

## 3. 运行服务器

使用以下命令运行服务器:

```bash
# 启动 Uvicorn 服务器，开启热重载模式
uvicorn main:app --reload
```

你应该会看到类似这样的输出:

```text
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345] using statreload
INFO:     Started server process [12345]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### 3.1 测试 API

在浏览器中打开 http://127.0.0.1:8000/items/5?q=somequery

你会看到 JSON 格式的响应:

```json
{"item_id": 5, "q": "somequery"}
```

你已经创建了一个 API，它可以:

* **接收** 路径 `/` 和 `/items/{item_id}` 的 HTTP 请求
* 两个路径都使用 `GET` **操作** (也称为 HTTP **方法**)
* 路径 `/items/{item_id}` 有一个 **路径参数** `item_id`，它应该是 `int` 类型
* 路径 `/items/{item_id}` 有一个可选的 `str` 类型 **查询参数** `q`

## 4. 交互式 API 文档

现在访问 http://127.0.0.1:8000/docs

你会看到自动生成的交互式 API 文档 (由 **Swagger UI** 提供):

![Swagger UI 界面示例](https://fastapi.tiangolo.com/img/index/index-01-swagger-ui02.png)

## 5. 备选 API 文档

现在访问 http://127.0.0.1:8000/redoc

你会看到另一种自动生成的文档 (由 **ReDoc** 提供):

![ReDoc 界面示例](https://fastapi.tiangolo.com/img/index/index-02-redoc.png)

## 6. 示例升级

现在修改 `main.py` 文件，让它从 `PUT` 请求中接收请求体。

使用 Pydantic 模型声明请求体 (与 `JSON Schema` 标准化)。

```python
# 导入 FastAPI 和 Pydantic 的 BaseModel
from fastapi import FastAPI
from pydantic import BaseModel


# 定义 Item 数据模型，用于验证请求体
class Item(BaseModel):
    name: str        # 名称字段，必填，字符串类型
    price: float     # 价格字段，必填，浮点数类型
    is_offer: bool = None  # 是否优惠，可选，布尔类型


# 创建 FastAPI 应用实例
app = FastAPI()


# 根路径操作，返回欢迎消息
@app.get("/")
def read_root():
    return {"Hello": "World"}


# 获取物品信息的路径操作
@app.get("/items/{item_id}")
def read_item(item_id: int, q: str = None):
    return {"item_id": item_id, "q": q}


# 更新物品的路径操作，接受请求体
@app.put("/items/{item_id}")
def update_item(item_id: int, item: Item):
    # 返回更新后的物品信息
    return {"item_name": item.name, "item_id": item_id}
```

服务器应该会自动重载 (因为你在 `uvicorn` 命令中添加了 `--reload` 参数)。

## 7. 交互式 API 文档升级

现在访问 http://127.0.0.1:8000/docs

* 交互式 API 文档会自动更新，包括新的请求体:

![更新后的 Swagger UI](https://fastapi.tiangolo.com/img/index/index-03-swagger-ui03.png)

* 点击 "Try it out" 按钮，它允许你填写参数并直接与 API 交互:

![Swagger UI 交互界面](https://fastapi.tiangolo.com/img/index/index-04-swagger-ui04.png)

* 点击 "Execute" 按钮，用户界面会与你的 API 通信，发送参数，获取结果并在屏幕上显示:

![执行结果](https://fastapi.tiangolo.com/img/index/index-05-swagger-ui05.png)

## 8. 总结

总之，你只需要一次声明参数、请求体等的类型，作为函数参数。

你使用标准的现代 Python 类型提示来完成这件事。

你不需要学习新的语法、特定库的方法或类等等。

只需要标准 Python 3.7+。

例如，对于 `int` 类型:

```python
item_id: int
```

或者一个更复杂的 `Item` 模型:

```python
item: Item
```

通过这单一声明，你获得了:

* 编辑器支持，包括:
    * 自动补全
    * 类型检查
* 数据验证:
    * 数据无效时自动给出清晰的错误信息
* API 文档的 **标准** JSON Schema (并自动用于验证)
* 生成的文档:
    * 交互式 API 文档
    * Web API 的备选文档
* 基于单一声明:
    * 多种语言的代码生成

## 9. 逐步回顾

### 9.1 步骤 1: 导入 FastAPI

```python
from fastapi import FastAPI
```

`FastAPI` 是一个 Python 类，为你的 API 提供所有功能。

### 9.2 步骤 2: 创建 FastAPI 实例

```python
app = FastAPI()
```

这个对象将是你应用程序的主要交互点。

按照约定命名为 `app`，但你可以使用任何你喜欢的名称。

### 9.3 步骤 3: 创建路径操作

```python
@app.get("/")
def read_root():
    ...
```

* `@app.get("/")` 告诉 FastAPI，下面的函数负责处理以下请求:
    * 路径为 `/`
    * 使用 **get** <http://方法> (HTTP 方法包括 PUT、POST、DELETE 等)

**`@something`**:

* 这个语法称为 "装饰器"
* 它在函数顶部放置一个 "包装器"
* 它接收下面的函数并对其进行一些操作

在本例中，装饰器告诉 FastAPI，下面的函数对应路径 `/` 和操作 `get`。

这是一个 **"路径操作"**。

**路径**:

* 这是域名之后的第一部分
* 例如，在这个 URL 中:
    * `https://example.com/items/foo`
    * 路径就是: `/items/foo`

**操作**:

* 这指的是 HTTP **方法**
* 以下之一:
    * `POST`
    * `GET`
    * `PUT`
    * `DELETE`
    * ...以及更少见的:
        * `OPTIONS`
        * `HEAD`
        * `PATCH`
        * `TRACE`

在 OpenAPI 中，这些都称为 **"操作"**。

我们称它们为 **"路径操作"**。

**定义路径操作函数**:

* 这是我们的 "路径操作函数"
    * `def read_root():`
        * `def` 是 Python 中用于声明函数的关键字
        * `read_root` 是函数名称
        * 你可以使用任何你想要的名称
        * 函数参数放在括号内
        * 然后冒号 `:` 结束声明
        * 每当 FastAPI 收到使用 `GET` 操作访问 URL `"/"` 的请求时，都会调用此函数

### 9.4 步骤 4: 返回内容

```python
    return {"Hello": "World"}
```

* 你可以返回 `dict`、`list`、单个值如 `str`、`int` 等
* 你还可以返回 Pydantic 模型 (稍后会详细介绍)
* 许多其他对象和模型也会自动转换为 JSON (包括 ORM 等)
* FastAPI 会使用与标准 Python `json` 库兼容的 `json.dumps()` 自动将此返回值转换为 JSON

### 9.5 步骤 5: 运行开发服务器

```bash
uvicorn main:app --reload
```

* `main`: 文件 `main.py` (Python "模块")
* `app`: 在 `main.py` 中用 `app = FastAPI()` 创建的对象
* `--reload`: 启用热重载，以便在代码更改时重启服务器

此命令启动服务器:

```text
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

### 9.6 步骤 6: 检查结果

在浏览器中打开 http://127.0.0.1:8000

你会看到 JSON 响应:

```json
{"Hello": "World"}
```

### 9.7 步骤 7: 交互式 API 文档

现在访问 http://127.0.0.1:8000/docs

你会看到自动生成的交互式 API 文档 (由 **Swagger UI** 提供):

![Swagger UI 示例](https://fastapi.tiangolo.com/img/index/index-01-swagger-ui02.png)

### 9.8 步骤 8: 备选 API 文档

现在访问 http://127.0.0.1:8000/redoc

你会看到另一种自动生成的文档 (由 **ReDoc** 提供):

![ReDoc 示例](https://fastapi.tiangolo.com/img/index/index-02-redoc.png)

## 10. 你已经完成了

你已经有了一个可以工作的 API，你可以用它来:

* 通过交互式文档与之交互: http://127.0.0.1:8000/docs
* 或使用备选文档: http://127.0.0.1:8000/redoc
* 或从代码访问它: http://127.0.0.1:8000/items/5?q=somequery

**回顾**:

* **步骤 1**: 导入 FastAPI
* **步骤 2**: 创建 `app` 实例
* **步骤 3**: 创建路径操作
* **步骤 4**: 定义路径操作函数 (使用 `def`)
* **步骤 5**: 返回内容
* **步骤 6**: 运行开发服务器 (如 Uvicorn)
* **步骤 7**: 检查交互式 API 文档
* **步骤 8**: (可选) 备选文档
* **步骤 9**: 完成

## 11. 就这些了 (暂时)

你已经看到了基本工作流程。

在接下来的教程中，你将学习如何:

* 使用 **参数** (路径、查询、请求体等)
* 使用 **数据验证**
* 声明 **安全性** 和认证
* 以及更多...

但首先，让我们看看可选章节。
