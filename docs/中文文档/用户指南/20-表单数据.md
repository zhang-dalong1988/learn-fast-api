# 表单数据

当你需要接收表单字段而不是 JSON 时, 可以使用 `Form`。

## 1. 导入 `Form`

从 `fastapi` 导入 `Form`:

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
# password 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def login(username: Annotated[str, Form()], password: Annotated[str, Form()]):
    return {"username": username}  # 返回包含用户名的字典
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
# password 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def login(username: Annotated[str, Form()], password: Annotated[str, Form()]):
    return {"username": username}  # 返回包含用户名的字典
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
# password 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
async def login(username: str = Form(), password: str = Form()):
    return {"username": username}  # 返回包含用户名的字典
```

## 2. 定义 `Form` 参数

创建表单参数的方式与创建 `Body` 或 `Query` 参数的方式相同:

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
# password 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def login(username: Annotated[str, Form()], password: Annotated[str, Form()]):
    return {"username": username}  # 返回包含用户名的字典
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
# password 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def login(username: Annotated[str, Form()], password: Annotated[str, Form()]):
    return {"username": username}  # 返回包含用户名的字典
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, Form  # 导入 FastAPI 和 Form 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/login/")  # 定义一个 POST 路由, 路径为 /login/
# username 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
# password 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
async def login(username: str = Form(), password: str = Form()):
    return {"username": username}  # 返回包含用户名的字典
```

例如, 在 OAuth2 规范的一种使用方式 (称为 "密码流") 中, 需要将 `username` 和 `password` 作为表单字段发送。

该规范要求字段必须精确命名为 `username` 和 `password`, 并且作为表单字段发送, 而不是 JSON。

使用 `Form`, 你可以声明与 `Body` (以及 `Query`、`Path`、`Cookie`) 相同的配置, 包括验证、示例、别名 (例如, 使用 `user-name` 而不是 `username`) 等。

信息

`Form` 是直接继承自 `Body` 的类。

提示

要声明表单主体, 你需要显式使用 `Form`, 因为没有它, 参数将被解释为查询参数或主体 (JSON) 参数。

## 3. 关于 "表单字段"

HTML 表单 (`<form></form>`) 向服务器发送数据的方式通常使用对该数据进行 "特殊" 编码, 这与 JSON 不同。

FastAPI 将确保从正确的位置读取该数据, 而不是 JSON。

技术细节

来自表单的数据通常使用 "媒体类型" `application/x-www-form-urlencoded` 编码。

但是当表单包含文件时, 它被编码为 `multipart/form-data`。你将在下一章阅读有关处理文件的内容。

如果你想了解更多关于这些编码和表单字段的信息, 请前往 MDN web 文档查看 `POST`。

警告

你可以在路径操作中声明多个 `Form` 参数, 但你也不能同时声明期望作为 JSON 接收的 `Body` 字段, 因为请求的主体将使用 `application/x-www-form-urlencoded` 而不是 `application/json` 编码。

这不是 FastAPI 的限制, 它是 HTTP 协议的一部分。

## 4. 总结

使用 `Form` 声明表单数据输入参数。
