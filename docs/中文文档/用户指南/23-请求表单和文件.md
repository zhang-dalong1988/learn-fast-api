# 请求表单和文件

你可以使用 `File` 和 `Form` 同时定义文件和表单字段。

## 1. 导入 `File` 和 `Form`

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 使用 Annotated 声明类型为 bytes, 并使用 File() 表示这是一个上传的文件
# fileb 参数: 使用 Annotated 声明类型为 UploadFile, 并使用 File() 表示这是一个上传的文件
# token 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 使用 Annotated 声明类型为 bytes, 并使用 File() 表示这是一个上传的文件
# fileb 参数: 使用 Annotated 声明类型为 UploadFile, 并使用 File() 表示这是一个上传的文件
# token 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 类型为 bytes, 默认值使用 File() 表示这是一个上传的文件
# fileb 参数: 类型为 UploadFile, 默认值使用 File() 表示这是一个上传的文件
# token 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
async def create_file(
    file: bytes = File(), fileb: UploadFile = File(), token: str = Form()
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

## 2. 定义 `File` 和 `Form` 参数

创建文件和表单参数的方式与创建 `Body` 或 `Query` 参数的方式相同:

### Python 3.9+

```python
from typing import Annotated  # 导入 Annotated 用于类型注解

from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 使用 Annotated 声明类型为 bytes, 并使用 File() 表示这是一个上传的文件
# fileb 参数: 使用 Annotated 声明类型为 UploadFile, 并使用 File() 表示这是一个上传的文件
# token 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

#### Python 3.8+ non-Annotated

```python
from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类
from typing_extensions import Annotated  # 从 typing_extensions 导入 Annotated (Python 3.8 需要)

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 使用 Annotated 声明类型为 bytes, 并使用 File() 表示这是一个上传的文件
# fileb 参数: 使用 Annotated 声明类型为 UploadFile, 并使用 File() 表示这是一个上传的文件
# token 参数: 使用 Annotated 声明类型为 str, 并使用 Form() 表示这是一个表单字段
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

提示

如果可能, 优先使用 `Annotated` 版本。

```python
from fastapi import FastAPI, File, Form, UploadFile  # 导入 FastAPI, File, Form 和 UploadFile 类

app = FastAPI()  # 创建 FastAPI 应用实例

@app.post("/files/")  # 定义一个 POST 路由, 路径为 /files/
# file 参数: 类型为 bytes, 默认值使用 File() 表示这是一个上传的文件
# fileb 参数: 类型为 UploadFile, 默认值使用 File() 表示这是一个上传的文件
# token 参数: 类型为 str, 默认值使用 Form() 表示这是一个表单字段
async def create_file(
    file: bytes = File(), fileb: UploadFile = File(), token: str = Form()
):
    return {
        "file_size": len(file),  # 返回文件的大小 (字节数)
        "token": token,  # 返回接收到的 token 值
        "fileb_content_type": fileb.content_type,  # 返回 fileb 文件的内容类型 (MIME 类型)
    }
```

文件和表单字段将作为表单数据上传, 你将接收到文件和表单字段。

并且你可以将某些文件声明为 `bytes`, 将某些文件声明为 `UploadFile`。

信息

要接收上传的文件和/或表单数据, 首先安装 `python-multipart`。

确保你创建了一个虚拟环境, 激活它, 然后安装它, 例如:

```
$ pip install python-multipart
```

## 3. 警告

你可以在一个路径操作中声明多个 `File` 和 `Form` 参数, 但你也不能同时声明期望作为 JSON 接收的 `Body` 字段, 因为请求的主体将使用 `multipart/form-data` 而不是 `application/json` 编码。

这不是 FastAPI 的限制, 它是 HTTP 协议的一部分。

## 4. 总结

当需要在同一个请求中接收数据和文件时, 使用 `File` 和 `Form`。
