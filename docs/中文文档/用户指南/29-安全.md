# 安全 - FastAPI

FastAPI 框架, 高性能, 易于学习, 快速编码, 可用于生产环境

处理安全性、身份验证和授权有很多方法。

而且这通常是一个复杂且 "困难" 的主题。

在许多框架和系统中, 仅仅处理安全性和身份验证就需要大量的工作和代码 (在许多情况下, 这可能占所有编写代码的 50% 或更多)。

__FastAPI__ 提供了多种工具来帮助你轻松、快速地以标准方式处理 __安全性__, 而无需研究和学习所有的安全规范。

但首先, 让我们检查一些小概念。

## 1. 赶时间?

如果你不关心这些术语, 只需要 _立即_ 添加基于用户名和密码的身份验证安全性, 请跳到下一章。

## 2. OAuth2

OAuth2 是一个规范, 定义了多种处理身份验证和授权的方法。

这是一个相当广泛的规范, 涵盖了几个复杂的用例。

它包括使用 "第三方" 进行身份验证的方法。

这就是所有 "使用 Facebook、Google、X (Twitter)、GitHub 登录" 系统底层使用的技术。

### 2.1 OAuth 1

曾经有一个 OAuth 1, 它与 OAuth2 非常不同, 也更复杂, 因为它包含了关于如何加密通信的直接规范。

如今它不是很流行或很少被使用。

OAuth2 没有指定如何加密通信, 它期望你的应用程序通过 HTTPS 提供服务。

提示

在 __部署__ 部分, 你将看到如何使用 Traefik 和 Let's Encrypt 免费设置 HTTPS。

## 3. OpenID Connect

OpenID Connect 是另一个规范, 基于 __OAuth2__。

它只是扩展了 OAuth2, 指定了 OAuth2 中相对模糊的一些内容, 以尝试使其更具互操作性。

例如, Google 登录使用 OpenID Connect (底层使用 OAuth2)。

但 Facebook 登录不支持 OpenID Connect。它有自己的 OAuth2 变体。

### 3.1 OpenID (不是 "OpenID Connect")

还有一个 "OpenID" 规范。它试图解决与 __OpenID Connect__ 相同的问题, 但不是基于 OAuth2。

因此, 它是一个完全额外的系统。

如今它不是很流行或很少被使用。

## 4. OpenAPI

OpenAPI (以前称为 Swagger) 是用于构建 API 的开放规范 (现在是 Linux Foundation 的一部分)。

__FastAPI__ 基于 __OpenAPI__。

这就是使多个自动交互式文档界面、代码生成等成为可能的原因。

OpenAPI 有一种方法来定义多个安全 "方案"。

通过使用它们, 你可以利用所有这些基于标准的工具, 包括这些交互式文档系统。

OpenAPI 定义了以下安全方案:

- `apiKey`: 应用程序特定的密钥, 可以来自:
  - 查询参数。
  - 请求头。
  - Cookie。
- `http`: 标准 HTTP 身份验证系统, 包括:
  - `bearer`: 带有 `Bearer` 值加上令牌的 `Authorization` 头。这继承自 OAuth2。
  - HTTP Basic 身份验证。
  - HTTP Digest 等。
- `oauth2`: 所有 OAuth2 处理安全性的方法 (称为 "流程")。
  - 其中几个流程适合构建 OAuth 2.0 身份验证提供程序 (如 Google、Facebook、X (Twitter)、GitHub 等):
    - `implicit`
    - `clientCredentials`
    - `authorizationCode`
  - 但有一个特定的 "流程" 可以完美地用于直接在同一应用程序中处理身份验证:
    - `password`: 接下来的几章将介绍此示例。
- `openIdConnect`: 有一种方法可以定义如何自动发现 OAuth2 身份验证数据。
  - 这种自动发现是在 OpenID Connect 规范中定义的。

提示

集成其他身份验证/授权提供程序 (如 Google、Facebook、X (Twitter)、GitHub 等) 也是可能的, 而且相对容易。

最复杂的问题是构建像这样的身份验证/授权提供程序, 但 __FastAPI__ 为你提供了轻松完成此任务的工具, 同时为你完成繁重的工作。

## 5. __FastAPI__ 工具

FastAPI 在 `fastapi.security` 模块中为这些安全方案中的每一个都提供了几个工具, 简化了这些安全机制的使用。

在接下来的章节中, 你将看到如何使用 __FastAPI__ 提供的这些工具为你的 API 添加安全性。

你还将看到它如何自动集成到交互式文档系统中。
