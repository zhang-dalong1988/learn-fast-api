# 查询参数和字符串验证

## 1. 声明更多元数据

你可以为查询参数声明额外的验证和元数据。

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, 使用 Query 添加验证规则
@app.get("/items/")
async def read_items(
    # q 是可选的查询参数, 使用 Query 添加验证
    q: str | None = Query(None, min_length=3, max_length=50),
):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

## 2. 添加正则表达式

你可以定义参数应该匹配的正则表达式模式:

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, 使用正则表达式验证
@app.get("/items/")
async def read_items(
    # q 必须匹配正则表达式 ^fixedquery$
    q: str | None = Query(None, min_length=3, max_length=50, pattern="^fixedquery$"),
):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

指定的正则表达式 `^fixedquery$` 检查参数 `q` 接收的值是 `fixedquery`。

## 3. 默认值

你可以为查询参数定义默认值:

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, q 有默认值
@app.get("/items/")
async def read_items(q: str = Query("fixedquery", min_length=3)):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

## 4. 设为必填

要使查询参数成为必填项, 你可以不声明默认值 (或使用 `...`):

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, q 是必填参数
@app.get("/items/")
async def read_items(q: str = Query(min_length=3)):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

## 5. 查询参数列表 / 多个值

你可以定义一个查询参数来接收多个值:

```python
# 导入 FastAPI, Query 和 List
from fastapi import FastAPI, Query
from typing import List

# 创建应用实例
app = FastAPI()


# 定义路径操作, q 是字符串列表
@app.get("/items/")
async def read_items(q: List[str] = Query(["foo", "bar"])):
    # 返回包含查询列表的字典
    query_items = {"q": q}
    return query_items
```

使用 URL `http://localhost:8000/items/?q=foo&q=bar`, 你会收到:

```json
{
    "q": [
        "foo",
        "bar"
    ]
}
```

## 6. 带默认值的查询参数列表 / 多个值

你也可以定义默认值列表:

```python
# 导入 FastAPI, Query 和 List
from fastapi import FastAPI, Query
from typing import List

# 创建应用实例
app = FastAPI()


# 定义路径操作, q 是字符串列表, 有默认值
@app.get("/items/")
async def read_items(q: List[str] = Query(["foo", "bar"], min_length=2)):
    # 返回包含查询列表的字典
    query_items = {"q": q}
    return query_items
```

## 7. 声明更多元数据

你可以添加关于参数的更多信息:

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, 添加完整的元数据
@app.get("/items/")
async def read_items(
    q: str
    | None = Query(
        None,
        title="Query string",  # 参数标题
        min_length=3,  # 最小长度
        max_length=50,  # 最大长度
        pattern="^fixedquery$",  # 正则表达式
    ),
):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

## 8. 别名参数

你可以为查询参数声明别名:

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, 使用别名
@app.get("/items/")
async def read_items(q: str | None = Query(None, alias="item-query")):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

现在你可以使用 URL `http://localhost:8000/items/?item-query=foo`。

## 9. 弃用参数

你可以将查询参数标记为已弃用:

```python
# 导入 FastAPI 和 Query 类
from fastapi import FastAPI, Query

# 创建应用实例
app = FastAPI()


# 定义路径操作, 标记参数为已弃用
@app.get("/items/")
async def read_items(
    q: str | None = Query(
        None,
        alias="item-query",  # 使用别名
        title="Query string",  # 参数标题
        description="Query string for the items to search in the database that have a good match",  # 参数描述
        min_length=3,  # 最小长度
        max_length=50,  # 最大长度
        pattern="^fixedquery$",  # 正则表达式
        deprecated=True,  # 标记为已弃用
    ),
):
    # 定义默认结果
    results = {"items": [{"item_id": "Foo"}, {"item_id": "Bar"}]}
    # 如果提供了 q, 添加到结果中
    if q:
        results.update({"q": q})
    # 返回结果
    return results
```

## 10. 在 `Path` 声明中包含 `Query`

`Query`, `Path` 和你接下来会看到的其他类都是 `Param` 的兄弟类。它们都继承自一个共同的 `Param` 类。

所以, 你可以从 `fastapi` 导入 `Query`, 就这样。

当你需要声明带有验证的查询参数时, 使用 `Query`。同样对于 `Path`, `Body` 等。

## 11. 总结

使用 `Query` 你可以:

* 为查询参数声明额外的验证和元数据
* 声明默认值
* 使参数成为必填项
* 声明参数为已弃用
* 添加别名
* 使用正则表达式
* 声明参数接收多个值

以及更多!
