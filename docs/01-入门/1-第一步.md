# 第一步

最简单的 FastAPI 文件可能如下所示：

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

将这段代码复制到文件 `main.py` 中。

运行实时服务器：

```bash
$ fastapi dev main.py

```

在输出中，会有一行类似于：

```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

这一行显示了你的应用程序在本地机器上提供服务的 URL。

### 检查它

在浏览器中打开 http://127.0.0.1:8000。

你将看到如下 JSON 响应：

```json
{ "message": "Hello World" }
```

### 交互式 API 文档

现在访问 http://127.0.0.1:8000/docs。

你将看到自动生成的交互式 API 文档（由 Swagger UI 提供）：

![Swagger UI](https://fastapi.tiangolo.com/img/index/index-01-swagger-ui-simple.png)

### 替代 API 文档

现在，访问 http://127.0.0.1:8000/redoc。

你将看到另一个自动文档（由 ReDoc 提供）：

![ReDoc](https://fastapi.tiangolo.com/img/index/index-02-redoc-simple.png)

### OpenAPI

**FastAPI** 使用 **OpenAPI** 标准为你的所有 API 生成一个"模式"。

#### "模式"

"模式"是对某个事物的定义或描述。不是实现它的代码，而只是一个抽象的描述。

#### API "模式"

在这种情况下，OpenAPI 是一个规范，规定了如何定义你的 API 模式。

这个模式定义包括你的 API 路径、它们可能接受的参数等。

#### 数据 "模式"

术语"模式"也可能指某些数据的形状，比如 JSON 内容。

在这种情况下，它将意味着 JSON 属性以及它们拥有的数据类型等。

#### OpenAPI 和 JSON Schema

OpenAPI 为你的 API 定义了一个 API 模式。该模式包括你的 API 发送和接收的数据的定义（或"模式"），使用 **JSON Schema**，即 JSON 数据模式的标准。

#### 检查 `openapi.json`

如果你对原始 OpenAPI 模式的样子感到好奇，FastAPI 会自动生成一个 JSON（模式），其中包含你的所有 API 的描述。

你可以直接在以下位置查看：http://127.0.0.1:8000/openapi.json。

它将显示一个以类似以下内容开头的 JSON：

```json
{
    "openapi": "3.1.0",
    "info": {
        "title": "FastAPI",
        "version": "0.1.0"
    },
    "paths": {
        "/items/": {
            "get": {
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {

...
```

#### OpenAPI 的用途

OpenAPI 模式是所包含的两个交互式文档系统的基础。

还有几十种替代方案，都基于 OpenAPI。你可以轻松地将其中任何一种替代方案添加到你用 **FastAPI** 构建的应用程序中。

你也可以用它来自动生成代码，用于与你的 API 通信的客户端。例如，前端、移动或物联网应用程序。

## 分步回顾

### 步骤 1：导入 `FastAPI`

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

`FastAPI` 是一个为你的 API 提供所有功能的 Python 类。

**技术细节**

`FastAPI` 是一个直接继承自 `Starlette` 的类。

你也可以使用 `FastAPI` 的所有 Starlette 功能。

### 步骤 2：创建一个 `FastAPI` "实例"

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

这里的 `app` 变量将是类 `FastAPI` 的一个"实例"。

这将是创建所有 API 的主要交互点。

### 步骤 3：创建一个*路径操作*

#### 路径

这里的"路径"指的是从第一个 `/` 开始的 URL 的最后一部分。

因此，在像这样的 URL 中：

```
https://example.com/items/foo
```

...路径将是：

```
/items/foo
```

**信息**

"路径"也通常称为"端点"或"路由"。

在构建 API 时，"路径"是分离"关注点"和"资源"的主要方式。

#### 操作

这里的"操作"指的是 HTTP "方法"之一。

以下之一：

- `POST`
- `GET`
- `PUT`
- `DELETE`

...以及更奇特的方法：

- `OPTIONS`
- `HEAD`
- `PATCH`
- `TRACE`

在 HTTP 协议中，你可以使用这些"方法"之一（或多个）与每个路径通信。

---

在构建 API 时，你通常使用这些特定的 HTTP 方法来执行特定的操作。

通常你使用：

- `POST`：创建数据。
- `GET`：读取数据。
- `PUT`：更新数据。
- `DELETE`：删除数据。

因此，在 OpenAPI 中，每个 HTTP 方法都称为一个"操作"。

我们也称它们为"**操作**"。

#### 定义一个*路径操作装饰器*

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

`@app.get("/")` 告诉 **FastAPI** 下面的函数负责处理以下请求：

- 路径 `/`
- 使用 `get` 操作

**`@decorator` 信息**

Python 中的 `@something` 语法称为"装饰器"。

你将它放在函数的顶部。就像一顶漂亮的装饰性帽子（我想这就是这个术语的来源）。

"装饰器"接收下面的函数并对其进行处理。

在我们的例子中，这个装饰器告诉 **FastAPI** 下面的函数对应于路径 `/` 和操作 `get`。

它是"**路径操作装饰器**"。

你也可以使用其他操作：

- `@app.post()`
- `@app.put()`
- `@app.delete()`

以及更奇特的：

- `@app.options()`
- `@app.head()`
- `@app.patch()`
- `@app.trace()`

**提示**

你可以随意使用每个操作（HTTP 方法）。

**FastAPI** 不强制执行任何特定的含义。

这里的信息作为指导方针，而不是要求。

例如，在使用 GraphQL 时，你通常只使用 `POST` 操作执行所有操作。

### 步骤 4：定义**路径操作函数**

这是我们的"**路径操作函数**"：

- **路径**：是 `/`。
- **操作**：是 `get`。
- **函数**：是"装饰器"下面的函数（`@app.get("/")` 下面）。

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

这是一个 Python 函数。

每当 **FastAPI** 接收到对 URL "`/`" 使用 `GET` 操作的请求时，它将调用此函数。

在这种情况下，它是一个 `async` 函数。

---

你也可以将其定义为普通函数而不是 `async def`：

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def root():
    return {"message": "Hello World"}
```

**注意**

如果你不知道区别，请查看 Async：_"赶时间？"_。

### 步骤 5：返回内容

Python 3.8+

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```

你可以返回 `dict`、`list`、作为 `str`、`int` 等的单一值。

你也可以返回 Pydantic 模型（稍后会看到更多相关内容）。

还有许多其他对象和模型将自动转换为 JSON（包括 ORM 等）。尝试使用你喜欢的那些，它们很可能已经得到支持。

## 总结

- 导入 `FastAPI`。
- 创建一个 `app` 实例。
- 使用 `@app.get("/")` 等装饰器编写一个**路径操作装饰器**。
- 定义一个**路径操作函数**；例如，`def root(): ...`。
- 使用命令 `fastapi dev` 运行开发服务器。
