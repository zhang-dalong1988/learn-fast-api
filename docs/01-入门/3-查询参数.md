# 查询参数

当你声明不属于路径参数的其他函数参数时，它们会被自动解释为"查询"参数。

```python
from fastapi import FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

@app.get("/items/")
async def read_item(skip: int = 0, limit: int = 10):
    return fake_items_db[skip : skip + limit]
```

查询是 URL 中 `?` 后面的键值对，用 `&` 字符分隔。

例如，在 URL 中：

```
http://127.0.0.1:8000/items/?skip=0&limit=10
```

查询参数为：

- `skip`: 值为 0
- `limit`: 值为 10

由于它们是 URL 的一部分，所以它们"天然"是字符串。但当你用 Python 类型声明它们时（如上例中的 int），它们会被转换为该类型并针对该类型进行验证。

所有应用于路径参数的相同过程也适用于查询参数：

- 编辑器支持（显然）
- 数据"解析"
- 数据验证
- 自动文档

## 默认值

由于查询参数不是路径的固定部分，所以它们可以是可选的，并且可以有默认值。

在上面的例子中，它们有默认值 `skip=0` 和 `limit=10`。

因此，访问 URL：

```
http://127.0.0.1:8000/items/
```

等同于访问：

```
http://127.0.0.1:8000/items/?skip=0&limit=10
```

但如果你访问，例如：

```
http://127.0.0.1:8000/items/?skip=20
```

函数中的参数值将是：

- `skip=20`：因为你在 URL 中设置了它
- `limit=10`：因为那是默认值

## 可选参数

同样，你可以通过设置默认为 `None` 来声明可选查询参数：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(item_id: str, q: str | None = None):
    if q:
        return {"item_id": item_id, "q": q}
    return {"item_id": item_id}
```

在这种情况下，函数参数 `q` 将是可选的，默认为 `None`。

**注意**：FastAPI 足够智能，能够注意到路径参数 `item_id` 是路径参数，而 `q` 不是，所以它是查询参数。

## 查询参数类型转换

你也可以声明 `bool` 类型，它们将被转换：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(
    item_id: str,
    q: str | None = None,
    short: bool = False
):
    item = {"item_id": item_id}
    if q:
        item.update({"q": q})
    if not short:
        item.update(
            {"description": "This is an amazing item that has a long description"}
        )
    return item
```

在这种情况下，如果你访问：

- `http://127.0.0.1:8000/items/foo?short=1`
- `http://127.0.0.1:8000/items/foo?short=True`
- `http://127.0.0.1:8000/items/foo?short=true`
- `http://127.0.0.1:8000/items/foo?short=on`
- `http://127.0.0.1:8000/items/foo?short=yes`

或任何其他大小写变体（大写、首字母大写等），你的函数将看到参数 `short` 的布尔值为 `True`。否则为 `False`。

## 多个路径和查询参数

你可以同时声明多个路径参数和查询参数，FastAPI 知道哪个是哪个。而且你不必按任何特定顺序声明它们。它们将通过名称被检测到：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/{user_id}/items/{item_id}")
async def read_user_item(
    user_id: int,
    item_id: str,
    q: str | None = None,
    short: bool = False
):
    item = {"item_id": item_id, "owner_id": user_id}
    if q:
        item.update({"q": q})
    if not short:
        item.update(
            {"description": "This is an amazing item that has a long description"}
        )
    return item
```

## 必需查询参数

当你为非路径参数声明默认值时，它就不是必需的。

如果你不想添加特定值而只是使其可选，将默认设置为 `None`。

但当你想要使查询参数成为必需时，你可以根本不声明任何默认值：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_user_item(item_id: str, needy: str):
    item = {"item_id": item_id, "needy": needy}
    return item
```

这里查询参数 `needy` 是类型为 `str` 的必需查询参数。

如果你在浏览器中打开像这样的 URL：

```
http://127.0.0.1:8000/items/foo-item
```

...而不添加必需参数 `needy`，你将看到这样的错误：

```json
{
  "detail": [
    {
      "type": "missing",
      "loc": ["query", "needy"],
      "msg": "Field required",
      "input": null
    }
  ]
}
```

由于 `needy` 是必需参数，你需要在 URL 中设置它：

```
http://127.0.0.1:8000/items/foo-item?needy=sooooneedy
```

...这将有效：

```json
{
  "item_id": "foo-item",
  "needy": "sooooneedy"
}
```

当然，你可以将一些参数定义为必需的，一些具有默认值，一些完全可选：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_user_item(
    item_id: str,
    needy: str,
    skip: int = 0,
    limit: int | None = None
):
    item = {"item_id": item_id, "needy": needy, "skip": skip, "limit": limit}
    return item
```

在这种情况下，有 3 个查询参数：

- `needy`: 必需的 str
- `skip`: 默认值为 0 的 int
- `limit`: 可选的 int

**提示**：你也可以像路径参数一样使用 Enums。

## 总结

查询参数提供了灵活的 API 接口设计：

- 通过函数参数自动声明
- 支持类型转换和验证
- 可以设置默认值
- 支持必需和可选参数
- 可以与路径参数混合使用

这些特性使得 FastAPI 能够构建强大且易于使用的 API。