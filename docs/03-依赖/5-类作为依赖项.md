# ç±»ä½œä¸ºä¾èµ–é¡¹

åœ¨æ·±å…¥ç ”ç©¶ä¾èµ–æ³¨å…¥ç³»ç»Ÿä¹‹å‰,è®©æˆ‘ä»¬å‡çº§å‰é¢çš„ä¾‹å­.

## å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ dict

åœ¨å‰é¢çš„ä¾‹å­ä¸­,æˆ‘ä»¬ä»ä¾èµ–é¡¹("dependable")è¿”å›äº†ä¸€ä¸ª dict:

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

ä½†æ˜¯è¿™æ ·æˆ‘ä»¬åœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•° `commons` ä¸­å¾—åˆ°çš„æ˜¯ä¸€ä¸ª `dict`.

è€Œä¸”æˆ‘ä»¬çŸ¥é“ç¼–è¾‘å™¨æ— æ³•ä¸º `dict` æä¾›å¾ˆå¤šæ”¯æŒ(æ¯”å¦‚è‡ªåŠ¨è¡¥å…¨),å› ä¸ºå®ƒä»¬æ— æ³•çŸ¥é“å…¶é”®å’Œå€¼çš„ç±»å‹.

æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½...

## ä»€ä¹ˆæ„æˆäº†ä¾èµ–é¡¹

åˆ°ç›®å‰ä¸ºæ­¢,ä½ å·²ç»çœ‹åˆ°äº†ä¾èµ–é¡¹è¢«å£°æ˜ä¸ºå‡½æ•°.

ä½†è¿™å¹¶ä¸æ˜¯å£°æ˜ä¾èµ–é¡¹çš„å”¯ä¸€æ–¹å¼(å°½ç®¡è¿™å¯èƒ½æ›´å¸¸è§).

å…³é”®å› ç´ æ˜¯ä¾èµ–é¡¹åº”è¯¥æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡".

åœ¨ Python ä¸­,"å¯è°ƒç”¨å¯¹è±¡"æ˜¯æŒ‡ä»»ä½• Python å¯ä»¥åƒå‡½æ•°ä¸€æ ·"è°ƒç”¨"çš„ä¸œè¥¿.

æ‰€ä»¥,å¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è±¡ `something`(å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå‡½æ•°),å¹¶ä¸”ä½ å¯ä»¥åƒè¿™æ ·"è°ƒç”¨"å®ƒ(æ‰§è¡Œå®ƒ):

```python
something()
```

æˆ–è€…

```python
something(some_argument, some_keyword_argument="foo")
```

é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡".

## ç±»ä½œä¸ºä¾èµ–é¡¹

ä½ å¯èƒ½æ³¨æ„åˆ°,è¦åˆ›å»ºä¸€ä¸ª Python ç±»çš„å®ä¾‹,ä½ ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„è¯­æ³•.

ä¾‹å¦‚:

```python
class Cat:
    def __init__(self, name: str):
        self.name = name

fluffy = Cat(name="Mr Fluffy")
```

åœ¨è¿™ç§æƒ…å†µä¸‹,`fluffy` æ˜¯ `Cat` ç±»çš„ä¸€ä¸ªå®ä¾‹.

è€Œè¦åˆ›å»º `fluffy`,ä½ æ˜¯åœ¨"è°ƒç”¨" `Cat`.

æ‰€ä»¥,Python ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡.

é‚£ä¹ˆ,åœ¨ FastAPI ä¸­,ä½ å¯ä»¥ä½¿ç”¨ Python ç±»ä½œä¸ºä¾èµ–é¡¹.

FastAPI å®é™…æ£€æŸ¥çš„æ˜¯å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡"(å‡½æ•°ã€ç±»æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿)ä»¥åŠå®šä¹‰çš„å‚æ•°.

å¦‚æœä½ åœ¨ FastAPI ä¸­å°†"å¯è°ƒç”¨å¯¹è±¡"ä½œä¸ºä¾èµ–é¡¹ä¼ é€’,å®ƒå°†åˆ†æè¯¥"å¯è°ƒç”¨å¯¹è±¡"çš„å‚æ•°,å¹¶ä»¥ä¸è·¯å¾„æ“ä½œå‡½æ•°å‚æ•°ç›¸åŒçš„æ–¹å¼å¤„ç†å®ƒä»¬.åŒ…æ‹¬å­ä¾èµ–é¡¹.

è¿™ä¹Ÿé€‚ç”¨äºå®Œå…¨æ²¡æœ‰å‚æ•°çš„å¯è°ƒç”¨å¯¹è±¡.å°±åƒæ²¡æœ‰å‚æ•°çš„è·¯å¾„æ“ä½œå‡½æ•°ä¸€æ ·.

ç„¶å,æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–é¡¹"dependable" `common_parameters` æ›´æ”¹ä¸ºç±» `CommonQueryParams`:

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

æ³¨æ„ç”¨äºåˆ›å»ºç±»å®ä¾‹çš„ `__init__` æ–¹æ³•:

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

...å®ƒä¸æˆ‘ä»¬ä¹‹å‰çš„ `common_parameters` å…·æœ‰ç›¸åŒçš„å‚æ•°:

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

è¿™äº›å‚æ•°å°±æ˜¯ FastAPI å°†ç”¨æ¥"è§£å†³"ä¾èµ–é¡¹çš„å†…å®¹.

åœ¨ä¸¤ç§æƒ…å†µä¸‹,å®ƒéƒ½å°†å…·æœ‰:

- ä¸€ä¸ªå¯é€‰çš„ `q` æŸ¥è¯¢å‚æ•°,ç±»å‹ä¸º `str`.
- ä¸€ä¸ª `skip` æŸ¥è¯¢å‚æ•°,ç±»å‹ä¸º `int`,é»˜è®¤å€¼ä¸º `0`.
- ä¸€ä¸ª `limit` æŸ¥è¯¢å‚æ•°,ç±»å‹ä¸º `int`,é»˜è®¤å€¼ä¸º `100`.

åœ¨ä¸¤ç§æƒ…å†µä¸‹,æ•°æ®éƒ½å°†è¢«è½¬æ¢ã€éªŒè¯ã€åœ¨ OpenAPI æ¨¡å¼ä¸­è®°å½•ç­‰.

## ä½¿ç”¨å®ƒ

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»å£°æ˜ä½ çš„ä¾èµ–é¡¹.

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

FastAPI è°ƒç”¨ `CommonQueryParams` ç±».è¿™ä¼šåˆ›å»ºè¯¥ç±»çš„"å®ä¾‹",è¯¥å®ä¾‹å°†ä½œä¸ºå‚æ•° `commons` ä¼ é€’ç»™ä½ çš„å‡½æ•°.

## ç±»å‹æ³¨è§£ vs `Depends`

æ³¨æ„æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­å†™äº†ä¸¤æ¬¡ `CommonQueryParams`:

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

æœ€åçš„ `CommonQueryParams`,åœ¨:

```python
... Depends(CommonQueryParams)
```

...ä¸­,æ˜¯ FastAPI å®é™…ç”¨æ¥çŸ¥é“ä¾èµ–é¡¹æ˜¯ä»€ä¹ˆçš„.

FastAPI å°†ä»è¿™ä¸ªç±»ä¸­æå–å£°æ˜çš„å‚æ•°,è¿™å°±æ˜¯ FastAPI å®é™…è°ƒç”¨çš„å†…å®¹.

---

åœ¨è¿™ç§æƒ…å†µä¸‹,ç¬¬ä¸€ä¸ª `CommonQueryParams`,åœ¨:

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, ...
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons: CommonQueryParams ...
```

...ä¸­,å¯¹ FastAPI æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰.FastAPI ä¸ä¼šç”¨å®ƒæ¥è¿›è¡Œæ•°æ®è½¬æ¢ã€éªŒè¯ç­‰(å› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯ `Depends(CommonQueryParams)` æ¥åšè¿™äº›).

ä½ å®é™…ä¸Šå¯ä»¥åªå†™:

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[Any, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons = Depends(CommonQueryParams)
```

...å°±åƒ:

Python 3.10+

```python
from typing import Annotated, Any

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Any, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Any, Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons=Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons=Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ä½†æ˜¯é¼“åŠ±å£°æ˜ç±»å‹,è¿™æ ·ä½ çš„ç¼–è¾‘å™¨å°±ä¼šçŸ¥é“å°†ä»€ä¹ˆä½œä¸ºå‚æ•° `commons` ä¼ é€’,ç„¶åå®ƒå¯ä»¥ä¸ºä½ æä¾›ä»£ç è¡¥å…¨ã€ç±»å‹æ£€æŸ¥ç­‰å¸®åŠ©:

![Image 1](https://fastapi.tiangolo.com/img/tutorial/dependencies/image02.png)

## å¿«æ·æ–¹å¼

ä½†æ˜¯ä½ çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€äº›ä»£ç é‡å¤,å†™äº†ä¸¤æ¬¡ `CommonQueryParams`:

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

FastAPI ä¸ºè¿™äº›æƒ…å†µæä¾›äº†ä¸€ä¸ªå¿«æ·æ–¹å¼,åœ¨è¿™äº›æƒ…å†µä¸‹,ä¾èµ–é¡¹æ˜¯ä¸€ä¸ª FastAPI å°†"è°ƒç”¨"ä»¥åˆ›å»ºç±»æœ¬èº«å®ä¾‹çš„ç±».

å¯¹äºè¿™äº›ç‰¹å®šæƒ…å†µ,ä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

è€Œä¸æ˜¯å†™:

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

...ä½ å†™:

Python 3.8+Python 3.8 non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends()]
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
commons: CommonQueryParams = Depends()
```

ä½ å°†ä¾èµ–é¡¹å£°æ˜ä¸ºå‚æ•°çš„ç±»å‹,å¹¶ä½¿ç”¨ `Depends()` ä¸å¸¦ä»»ä½•å‚æ•°,è€Œä¸å¿…åœ¨ `Depends(CommonQueryParams)` å†…éƒ¨å†æ¬¡å†™å…¥å®Œæ•´çš„ç±».

ç„¶åç›¸åŒçš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤º:

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends()):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½,ä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬.

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends()):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

...FastAPI ä¼šçŸ¥é“è¯¥æ€ä¹ˆåš.

Tip

å¦‚æœè¿™çœ‹èµ·æ¥æ¯”æœ‰å¸®åŠ©æ›´ä»¤äººå›°æƒ‘,è¯·å¿½ç•¥å®ƒ,ä½ å¹¶ä¸"éœ€è¦"å®ƒ.

è¿™åªæ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼.å› ä¸º FastAPI å…³å¿ƒçš„æ˜¯å¸®åŠ©ä½ å‡å°‘ä»£ç é‡å¤.