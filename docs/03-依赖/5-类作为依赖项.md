# ç±»ä½œä¸ºä¾èµ–é¡¹

åœ¨æ·±å…¥ç ”ç©¶ä¾èµ–æ³¨å…¥ç³»ç»Ÿä¹‹å‰ï¼Œè®©æˆ‘ä»¬å‡çº§å‰é¢çš„ä¾‹å­ã€‚

## å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ dict

åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»ä¾èµ–é¡¹ï¼ˆ"dependable"ï¼‰è¿”å›äº†ä¸€ä¸ª dictï¼š

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

ä½†æ˜¯è¿™æ ·æˆ‘ä»¬åœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•° `commons` ä¸­å¾—åˆ°çš„æ˜¯ä¸€ä¸ª `dict`ã€‚

è€Œä¸”æˆ‘ä»¬çŸ¥é“ç¼–è¾‘å™¨æ— æ³•ä¸º `dict` æä¾›å¾ˆå¤šæ”¯æŒï¼ˆæ¯”å¦‚è‡ªåŠ¨è¡¥å…¨ï¼‰ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•çŸ¥é“å…¶é”®å’Œå€¼çš„ç±»å‹ã€‚

æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½...

## ä»€ä¹ˆæ„æˆäº†ä¾èµ–é¡¹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»çœ‹åˆ°äº†ä¾èµ–é¡¹è¢«å£°æ˜ä¸ºå‡½æ•°ã€‚

ä½†è¿™å¹¶ä¸æ˜¯å£°æ˜ä¾èµ–é¡¹çš„å”¯ä¸€æ–¹å¼ï¼ˆå°½ç®¡è¿™å¯èƒ½æ›´å¸¸è§ï¼‰ã€‚

å…³é”®å› ç´ æ˜¯ä¾èµ–é¡¹åº”è¯¥æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡"ã€‚

åœ¨ Python ä¸­ï¼Œ"å¯è°ƒç”¨å¯¹è±¡"æ˜¯æŒ‡ä»»ä½• Python å¯ä»¥åƒå‡½æ•°ä¸€æ ·"è°ƒç”¨"çš„ä¸œè¥¿ã€‚

æ‰€ä»¥ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è±¡ `something`ï¼ˆå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œå¹¶ä¸”ä½ å¯ä»¥åƒè¿™æ ·"è°ƒç”¨"å®ƒï¼ˆæ‰§è¡Œå®ƒï¼‰ï¼š

```python
something()
```

æˆ–è€…

```python
something(some_argument, some_keyword_argument="foo")
```

é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡"ã€‚

## ç±»ä½œä¸ºä¾èµ–é¡¹

ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œè¦åˆ›å»ºä¸€ä¸ª Python ç±»çš„å®ä¾‹ï¼Œä½ ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„è¯­æ³•ã€‚

ä¾‹å¦‚ï¼š

```python
class Cat:
    def __init__(self, name: str):
        self.name = name

fluffy = Cat(name="Mr Fluffy")
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`fluffy` æ˜¯ `Cat` ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚

è€Œè¦åˆ›å»º `fluffy`ï¼Œä½ æ˜¯åœ¨"è°ƒç”¨" `Cat`ã€‚

æ‰€ä»¥ï¼ŒPython ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ã€‚

é‚£ä¹ˆï¼Œåœ¨ FastAPI ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ Python ç±»ä½œä¸ºä¾èµ–é¡¹ã€‚

FastAPI å®é™…æ£€æŸ¥çš„æ˜¯å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ª"å¯è°ƒç”¨å¯¹è±¡"ï¼ˆå‡½æ•°ã€ç±»æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼‰ä»¥åŠå®šä¹‰çš„å‚æ•°ã€‚

å¦‚æœä½ åœ¨ FastAPI ä¸­å°†"å¯è°ƒç”¨å¯¹è±¡"ä½œä¸ºä¾èµ–é¡¹ä¼ é€’ï¼Œå®ƒå°†åˆ†æè¯¥"å¯è°ƒç”¨å¯¹è±¡"çš„å‚æ•°ï¼Œå¹¶ä»¥ä¸è·¯å¾„æ“ä½œå‡½æ•°å‚æ•°ç›¸åŒçš„æ–¹å¼å¤„ç†å®ƒä»¬ã€‚åŒ…æ‹¬å­ä¾èµ–é¡¹ã€‚

è¿™ä¹Ÿé€‚ç”¨äºå®Œå…¨æ²¡æœ‰å‚æ•°çš„å¯è°ƒç”¨å¯¹è±¡ã€‚å°±åƒæ²¡æœ‰å‚æ•°çš„è·¯å¾„æ“ä½œå‡½æ•°ä¸€æ ·ã€‚

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–é¡¹"dependable" `common_parameters` æ›´æ”¹ä¸ºç±» `CommonQueryParams`ï¼š

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

æ³¨æ„ç”¨äºåˆ›å»ºç±»å®ä¾‹çš„ `__init__` æ–¹æ³•ï¼š

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

...å®ƒä¸æˆ‘ä»¬ä¹‹å‰çš„ `common_parameters` å…·æœ‰ç›¸åŒçš„å‚æ•°ï¼š

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons

@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

async def common_parameters(
    q: Union[str, None] = None, skip: int = 0, limit: int = 100
):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: dict = Depends(common_parameters)):
    return commons

@app.get("/users/")
async def read_users(commons: dict = Depends(common_parameters)):
    return commons
```

è¿™äº›å‚æ•°å°±æ˜¯ FastAPI å°†ç”¨æ¥"è§£å†³"ä¾èµ–é¡¹çš„å†…å®¹ã€‚

åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œå®ƒéƒ½å°†å…·æœ‰ï¼š

- ä¸€ä¸ªå¯é€‰çš„ `q` æŸ¥è¯¢å‚æ•°ï¼Œç±»å‹ä¸º `str`ã€‚
- ä¸€ä¸ª `skip` æŸ¥è¯¢å‚æ•°ï¼Œç±»å‹ä¸º `int`ï¼Œé»˜è®¤å€¼ä¸º `0`ã€‚
- ä¸€ä¸ª `limit` æŸ¥è¯¢å‚æ•°ï¼Œç±»å‹ä¸º `int`ï¼Œé»˜è®¤å€¼ä¸º `100`ã€‚

åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ•°æ®éƒ½å°†è¢«è½¬æ¢ã€éªŒè¯ã€åœ¨ OpenAPI æ¨¡å¼ä¸­è®°å½•ç­‰ã€‚

## ä½¿ç”¨å®ƒ

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»å£°æ˜ä½ çš„ä¾èµ–é¡¹ã€‚

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

FastAPI è°ƒç”¨ `CommonQueryParams` ç±»ã€‚è¿™ä¼šåˆ›å»ºè¯¥ç±»çš„"å®ä¾‹"ï¼Œè¯¥å®ä¾‹å°†ä½œä¸ºå‚æ•° `commons` ä¼ é€’ç»™ä½ çš„å‡½æ•°ã€‚

## ç±»å‹æ³¨è§£ vs `Depends`

æ³¨æ„æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­å†™äº†ä¸¤æ¬¡ `CommonQueryParams`ï¼š

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

æœ€åçš„ `CommonQueryParams`ï¼Œåœ¨ï¼š

```python
... Depends(CommonQueryParams)
```

...ä¸­ï¼Œæ˜¯ FastAPI å®é™…ç”¨æ¥çŸ¥é“ä¾èµ–é¡¹æ˜¯ä»€ä¹ˆçš„ã€‚

FastAPI å°†ä»è¿™ä¸ªç±»ä¸­æå–å£°æ˜çš„å‚æ•°ï¼Œè¿™å°±æ˜¯ FastAPI å®é™…è°ƒç”¨çš„å†…å®¹ã€‚

---

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ª `CommonQueryParams`ï¼Œåœ¨ï¼š

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, ...
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons: CommonQueryParams ...
```

...ä¸­ï¼Œå¯¹ FastAPI æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰ã€‚FastAPI ä¸ä¼šç”¨å®ƒæ¥è¿›è¡Œæ•°æ®è½¬æ¢ã€éªŒè¯ç­‰ï¼ˆå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯ `Depends(CommonQueryParams)` æ¥åšè¿™äº›ï¼‰ã€‚

ä½ å®é™…ä¸Šå¯ä»¥åªå†™ï¼š

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[Any, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons = Depends(CommonQueryParams)
```

...å°±åƒï¼š

Python 3.10+

```python
from typing import Annotated, Any

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Any, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Any, Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[Any, Depends(CommonQueryParams)]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons=Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons=Depends(CommonQueryParams)):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ä½†æ˜¯é¼“åŠ±å£°æ˜ç±»å‹ï¼Œè¿™æ ·ä½ çš„ç¼–è¾‘å™¨å°±ä¼šçŸ¥é“å°†ä»€ä¹ˆä½œä¸ºå‚æ•° `commons` ä¼ é€’ï¼Œç„¶åå®ƒå¯ä»¥ä¸ºä½ æä¾›ä»£ç è¡¥å…¨ã€ç±»å‹æ£€æŸ¥ç­‰å¸®åŠ©ï¼š

![Image 1](https://fastapi.tiangolo.com/img/tutorial/dependencies/image02.png)

## å¿«æ·æ–¹å¼

ä½†æ˜¯ä½ çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€äº›ä»£ç é‡å¤ï¼Œå†™äº†ä¸¤æ¬¡ `CommonQueryParams`ï¼š

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

FastAPI ä¸ºè¿™äº›æƒ…å†µæä¾›äº†ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¾èµ–é¡¹æ˜¯ä¸€ä¸ª FastAPI å°†"è°ƒç”¨"ä»¥åˆ›å»ºç±»æœ¬èº«å®ä¾‹çš„ç±»ã€‚

å¯¹äºè¿™äº›ç‰¹å®šæƒ…å†µï¼Œä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

è€Œä¸æ˜¯å†™ï¼š

Python 3.8+Python 3.8+ non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends(CommonQueryParams)]
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons: CommonQueryParams = Depends(CommonQueryParams)
```

...ä½ å†™ï¼š

Python 3.8+Python 3.8 non-Annotated

```python
commons: Annotated[CommonQueryParams, Depends()]
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
commons: CommonQueryParams = Depends()
```

ä½ å°†ä¾èµ–é¡¹å£°æ˜ä¸ºå‚æ•°çš„ç±»å‹ï¼Œå¹¶ä½¿ç”¨ `Depends()` ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œè€Œä¸å¿…åœ¨ `Depends(CommonQueryParams)` å†…éƒ¨å†æ¬¡å†™å…¥å®Œæ•´çš„ç±»ã€‚

ç„¶åç›¸åŒçš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š

Python 3.10+

```python
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

Python 3.9+Python 3.8+Python 3.10+ - non-AnnotatedPython 3.8+ - non-Annotated

```python
from typing import Annotated, Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

```python
from typing import Union

from fastapi import Depends, FastAPI
from typing_extensions import Annotated

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: Annotated[CommonQueryParams, Depends()]):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends()):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

Tip

å¦‚æœå¯èƒ½ï¼Œä¼˜å…ˆä½¿ç”¨ Annotated ç‰ˆæœ¬ã€‚

```python
from typing import Union

from fastapi import Depends, FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]

class CommonQueryParams:
    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit

@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends()):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

...FastAPI ä¼šçŸ¥é“è¯¥æ€ä¹ˆåšã€‚

Tip

å¦‚æœè¿™çœ‹èµ·æ¥æ¯”æœ‰å¸®åŠ©æ›´ä»¤äººå›°æƒ‘ï¼Œè¯·å¿½ç•¥å®ƒï¼Œä½ å¹¶ä¸"éœ€è¦"å®ƒã€‚

è¿™åªæ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ã€‚å› ä¸º FastAPI å…³å¿ƒçš„æ˜¯å¸®åŠ©ä½ å‡å°‘ä»£ç é‡å¤ã€‚