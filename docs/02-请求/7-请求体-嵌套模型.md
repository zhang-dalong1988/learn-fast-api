# è¯·æ±‚ä½“ - åµŒå¥—æ¨¡å‹ - FastAPI æ•™ç¨‹

## æ¦‚è¦

æœ¬ç« ä»‹ç» FastAPI ä¸­åµŒå¥—æ¨¡å‹çš„ä½¿ç”¨,è¿™æ˜¯æ„å»ºå¤æ‚ API çš„å…³é”®æŠ€æœ¯.ä½ å°†å­¦ä¹ å¦‚ä½•å¤„ç†åˆ—è¡¨ã€åµŒå¥—å¯¹è±¡å’Œå¤æ‚æ•°æ®ç»“æ„,ä»¥ä¾¿åœ¨ç°å®åº”ç”¨ä¸­å®šä¹‰ç²¾ç¡®çš„æ•°æ®æ¨¡å‹.

### æ ¸å¿ƒå†…å®¹

- åˆ—è¡¨å’Œé›†åˆç±»å‹
- æ¨¡å‹åµŒå¥—ä¸æ·±åº¦åµŒå¥—
- ç‰¹æ®ŠéªŒè¯ç±»å‹(å¦‚ HttpUrl)

---

ä½¿ç”¨ FastAPI,ä½ å¯ä»¥å®šä¹‰ã€éªŒè¯ã€æ–‡æ¡£åŒ–å’Œä½¿ç”¨ä»»æ„æ·±åº¦åµŒå¥—çš„æ¨¡å‹(æ„Ÿè°¢ Pydantic).

## 1. åˆ—è¡¨å­—æ®µ

ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå±æ€§ä¸ºå­ç±»å‹.ä¾‹å¦‚,ä¸€ä¸ª Python `list`:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()  # åˆ›å»º FastAPI åº”ç”¨

class Item(BaseModel):  # å®šä¹‰å•†å“æ¨¡å‹
    name: str  # å•†å“åç§°(å¿…éœ€)
    description: str | None = None  # å•†å“æè¿°(å¯é€‰)
    price: float  # å•†å“ä»·æ ¼(å¿…éœ€)
    tax: float | None = None  # ç¨ç‡(å¯é€‰)
    tags: list = []  # æ ‡ç­¾åˆ—è¡¨,é»˜è®¤ä¸ºç©ºåˆ—è¡¨

@app.put("/items/{item_id}")  # PUT è·¯ç”±ç”¨äºæ›´æ–°å•†å“
async def update_item(item_id: int, item: Item):  # item å‚æ•°å°†æ˜¯ Item æ¨¡å‹å®ä¾‹
    results = {"item_id": item_id, "item": item}
    return results
```

è¿™å°†ä½¿ `tags` æˆä¸ºä¸€ä¸ªåˆ—è¡¨,è™½ç„¶æ²¡æœ‰å£°æ˜åˆ—è¡¨å…ƒç´ çš„ç±»å‹.

## 2. å¸¦ç±»å‹å‚æ•°çš„åˆ—è¡¨å­—æ®µ

ä½† Python æœ‰ä¸€ç§ç‰¹å®šçš„æ–¹å¼æ¥å£°æ˜å¸¦æœ‰å†…éƒ¨ç±»å‹æˆ–"ç±»å‹å‚æ•°"çš„åˆ—è¡¨:

### 2.1 å¯¼å…¥ typing çš„ List

åœ¨ Python 3.9 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­,ä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ `list` æ¥å£°æ˜è¿™äº›ç±»å‹æ³¨è§£.ğŸ’¡

ä½†åœ¨ 3.9 ä¹‹å‰çš„ Python ç‰ˆæœ¬(3.6 åŠä»¥ä¸Š)ä¸­,ä½ é¦–å…ˆéœ€è¦ä»æ ‡å‡† Python çš„ `typing` æ¨¡å—å¯¼å…¥ `List`:

```python
# Python 3.8+
from typing import List, Union  # List ç”¨äºåˆ—è¡¨ç±»å‹æ³¨è§£,Union ç”¨äºå¯é€‰ç±»å‹

from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None
    tags: List[str] = []  # æ˜ç¡®æŒ‡å®šä¸ºå­—ç¬¦ä¸²åˆ—è¡¨

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

### 2.2 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None  # Python 3.10+ ä½¿ç”¨ | è¯­æ³•
    price: float
    tax: float | None = None
    tags: list[str] = []  # ä½¿ç”¨æ ‡å‡† list è¯­æ³•

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

```python
# Python 3.9+
from typing import Union  # Python 3.9 ä»éœ€è¦ Union

from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None
    tags: list[str] = []  # Python 3.9+ å¯ä»¥ä½¿ç”¨ list[str]

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

### 2.3 å£°æ˜å¸¦æœ‰ç±»å‹å‚æ•°çš„ list

è¦å£°æ˜å…·æœ‰ç±»å‹å‚æ•°(å†…éƒ¨ç±»å‹)çš„ç±»å‹,å¦‚ `list`ã€`dict`ã€`tuple`:

- å¦‚æœä½ ä½¿ç”¨çš„ Python ç‰ˆæœ¬ä½äº 3.9,ä» `typing` æ¨¡å—å¯¼å…¥å®ƒä»¬çš„ç­‰æ•ˆç‰ˆæœ¬
- ä½¿ç”¨æ–¹æ‹¬å· `[` å’Œ `]` å°†å†…éƒ¨ç±»å‹ä½œä¸º"ç±»å‹å‚æ•°"ä¼ é€’

åœ¨ Python 3.9 ä¸­,å®ƒä¼šæ˜¯:

```python
my_list: list[str]  # æ ‡å‡† Python 3.9+ è¯­æ³•
```

åœ¨ 3.9 ä¹‹å‰çš„ Python ç‰ˆæœ¬ä¸­,å®ƒä¼šæ˜¯:

```python
from typing import List

my_list: List[str]  # æ—§ç‰ˆæœ¬è¯­æ³•
```

è¿™äº›éƒ½æ˜¯æ ‡å‡†çš„ Python ç±»å‹å£°æ˜è¯­æ³•.

å¯¹å…·æœ‰å†…éƒ¨ç±»å‹çš„æ¨¡å‹å±æ€§ä½¿ç”¨ç›¸åŒçš„æ ‡å‡†è¯­æ³•.

å› æ­¤,åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­,æˆ‘ä»¬å¯ä»¥ä½¿ `tags` ç‰¹åˆ«æˆä¸º"å­—ç¬¦ä¸²åˆ—è¡¨":

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []  # æ˜ç¡®æŒ‡å®šä¸ºå­—ç¬¦ä¸²åˆ—è¡¨

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

## 3. é›†åˆç±»å‹

ä½†ç„¶åæˆ‘ä»¬æ€è€ƒä¸€ä¸‹,æ„è¯†åˆ°æ ‡ç­¾ä¸åº”è¯¥é‡å¤,å®ƒä»¬å¯èƒ½æ˜¯å”¯ä¸€çš„å­—ç¬¦ä¸².

è€Œ Python æœ‰ä¸€ä¸ªç”¨äºå”¯ä¸€é¡¹é›†åˆçš„ç‰¹æ®Šæ•°æ®ç±»å‹,å³ `set`.

ç„¶åæˆ‘ä»¬å¯ä»¥å°† `tags` å£°æ˜ä¸ºå­—ç¬¦ä¸²é›†åˆ:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()  # ä½¿ç”¨ set è‡ªåŠ¨å»é‡

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

### 3.1 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.8+
from typing import Set, Union  # Set ç”¨äºé›†åˆç±»å‹

from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None
    tags: Set[str] = set()  # ä½¿ç”¨ Set ç±»å‹

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

è¿™æ ·,å³ä½¿ä½ æ”¶åˆ°åŒ…å«é‡å¤æ•°æ®çš„è¯·æ±‚,å®ƒä¹Ÿä¼šè¢«è½¬æ¢ä¸ºå”¯ä¸€é¡¹çš„é›†åˆ.

å¹¶ä¸”æ¯å½“ä½ è¾“å‡ºè¯¥æ•°æ®æ—¶,å³ä½¿æºæ•°æ®æœ‰é‡å¤,å®ƒä¹Ÿä¼šä½œä¸ºå”¯ä¸€é¡¹çš„é›†åˆè¾“å‡º.

å®ƒä¹Ÿä¼šè¢«ç›¸åº”åœ°æ³¨è§£/è®°å½•åœ¨æ–‡æ¡£ä¸­.

## 4. åµŒå¥—æ¨¡å‹

Pydantic æ¨¡å‹çš„æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªç±»å‹.

ä½†è¯¥ç±»å‹æœ¬èº«å¯ä»¥æ˜¯å¦ä¸€ä¸ª Pydantic æ¨¡å‹.

å› æ­¤,ä½ å¯ä»¥å£°æ˜å…·æœ‰ç‰¹å®šå±æ€§åç§°ã€ç±»å‹å’ŒéªŒè¯çš„æ·±åº¦åµŒå¥—çš„ JSON "å¯¹è±¡".

æ‰€æœ‰è¿™äº›,éƒ½å¯ä»¥ä»»æ„åµŒå¥—.

### 4.1 å®šä¹‰å­æ¨¡å‹

ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª `Image` æ¨¡å‹:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Image(BaseModel):  # å®šä¹‰å›¾åƒæ¨¡å‹
    url: str  # å›¾åƒ URL
    name: str  # å›¾åƒåç§°

class Item(BaseModel):  # å•†å“æ¨¡å‹åŒ…å«å›¾åƒ
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()
    image: Image | None = None  # å¯é€‰çš„å›¾åƒåµŒå¥—æ¨¡å‹

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

### 4.2 ä½¿ç”¨å­æ¨¡å‹ä½œä¸ºç±»å‹

ç„¶åæˆ‘ä»¬å¯ä»¥å°†å…¶ç”¨ä½œå±æ€§çš„ç±»å‹:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Image(BaseModel):  # å›¾åƒå­æ¨¡å‹
    url: str
    name: str

class Item(BaseModel):  # å•†å“ä¸»æ¨¡å‹
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()
    image: Image | None = None  # åµŒå¥— Image æ¨¡å‹ä½œä¸ºç±»å‹

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

è¿™æ„å‘³ç€ FastAPI ä¼šæœŸæœ›ç±»ä¼¼äºä»¥ä¸‹çš„è¯·æ±‚ä½“:

```json
{
  "name": "Foo",
  "description": "The pretender",
  "price": 42.0,
  "tax": 3.2,
  "tags": ["rock", "metal", "bar"],
  "image": {
    "url": "http://example.com/baz.jpg",
    "name": "The Foo live"
  }
}
```

åŒæ ·,ä»…é€šè¿‡è¯¥å£°æ˜,ä½¿ç”¨ FastAPI ä½ å¯ä»¥è·å¾—:

- ç¼–è¾‘å™¨æ”¯æŒ(è‡ªåŠ¨è¡¥å…¨ç­‰),å³ä½¿å¯¹äºåµŒå¥—æ¨¡å‹
- æ•°æ®è½¬æ¢
- æ•°æ®éªŒè¯
- è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ

## 5. ç‰¹æ®Šç±»å‹å’ŒéªŒè¯

é™¤äº†åƒ `str`ã€`int`ã€`float` ç­‰æ™®é€šçš„å•ä¸€ç±»å‹å¤–,ä½ å¯ä»¥ä½¿ç”¨ç»§æ‰¿è‡ª `str` çš„æ›´å¤æ‚çš„å•ä¸€ç±»å‹.

è¦æŸ¥çœ‹ä½ æ‹¥æœ‰çš„æ‰€æœ‰é€‰é¡¹,è¯·æŸ¥çœ‹ Pydantic çš„ç±»å‹æ¦‚è¿°.ä½ å°†åœ¨ä¸‹ä¸€ç« çœ‹åˆ°ä¸€äº›ç¤ºä¾‹.

ä¾‹å¦‚,æ­£å¦‚åœ¨ `Image` æ¨¡å‹ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ª `url` å­—æ®µ,æˆ‘ä»¬å¯ä»¥å°†å…¶å£°æ˜ä¸º Pydantic çš„ `HttpUrl` å®ä¾‹,è€Œä¸æ˜¯ `str`:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl  # å¯¼å…¥ HttpUrl ç‰¹æ®Šç±»å‹

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl  # ä½¿ç”¨ HttpUrl ç±»å‹è¿›è¡Œ URL éªŒè¯
    name: str

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()
    image: Image | None = None

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

å­—ç¬¦ä¸²å°†è¢«æ£€æŸ¥ä¸ºæœ‰æ•ˆçš„ URL,å¹¶ç›¸åº”åœ°åœ¨ JSON Schema / OpenAPI ä¸­è®°å½•.

## 6. åŒ…å«å­æ¨¡å‹åˆ—è¡¨çš„å±æ€§

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Pydantic æ¨¡å‹ä½œä¸º `list`ã€`set` ç­‰çš„å­ç±»å‹:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl
    name: str

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()
    images: list[Image] | None = None  # åŒ…å« Image æ¨¡å‹çš„åˆ—è¡¨

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

### 6.1 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.8+
from typing import List, Set, Union

from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl
    name: str

class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None
    tags: Set[str] = set()
    images: Union[List[Image], None] = None  # ä½¿ç”¨ Union å’Œ List

@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    results = {"item_id": item_id, "item": item}
    return results
```

è¿™å°†æœŸæœ›(è½¬æ¢ã€éªŒè¯ã€æ–‡æ¡£åŒ–ç­‰)ç±»ä¼¼äºä»¥ä¸‹çš„ JSON è¯·æ±‚ä½“:

```json
{
  "name": "Foo",
  "description": "The pretender",
  "price": 42.0,
  "tax": 3.2,
  "tags": ["rock", "metal", "bar"],
  "images": [
    {
      "url": "http://example.com/baz.jpg",
      "name": "The Foo live"
    },
    {
      "url": "http://example.com/dave.jpg",
      "name": "The Baz"
    }
  ]
}
```

**æ³¨æ„**:æ³¨æ„ `images` é”®ç°åœ¨å¦‚ä½•åŒ…å«ä¸€ä¸ªå›¾åƒå¯¹è±¡åˆ—è¡¨.

## 7. æ·±åº¦åµŒå¥—æ¨¡å‹

ä½ å¯ä»¥å®šä¹‰ä»»æ„æ·±åº¦åµŒå¥—çš„æ¨¡å‹:

```python
# Python 3.10+
from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):  # æœ€æ·±å±‚:å›¾åƒæ¨¡å‹
    url: HttpUrl
    name: str

class Item(BaseModel):  # ä¸­é—´å±‚:å•†å“æ¨¡å‹
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: set[str] = set()
    images: list[Image] | None = None  # åŒ…å«å›¾åƒåˆ—è¡¨

class Offer(BaseModel):  # é¡¶å±‚:æŠ¥ä»·æ¨¡å‹
    name: str
    description: str | None = None
    price: float
    items: list[Item]  # åŒ…å«å•†å“åˆ—è¡¨

@app.post("/offers/")  # åˆ›å»ºæŠ¥ä»·
async def create_offer(offer: Offer):
    return offer
```

### 7.1 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.8+
from typing import List, Set, Union

from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl
    name: str

class Item(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    tax: Union[float, None] = None
    tags: Set[str] = set()
    images: Union[List[Image], None] = None

class Offer(BaseModel):
    name: str
    description: Union[str, None] = None
    price: float
    items: List[Item]  # å•†å“åˆ—è¡¨

@app.post("/offers/")
async def create_offer(offer: Offer):
    return offer
```

**æ³¨æ„**:æ³¨æ„ `Offer` å¦‚ä½•åŒ…å«ä¸€ä¸ª `Item` åˆ—è¡¨,è€Œ `Item` åˆåŒ…å«ä¸€ä¸ªå¯é€‰çš„ `Image` åˆ—è¡¨.

## 8. çº¯åˆ—è¡¨ä½“

å¦‚æœä½ æœŸæœ›çš„ JSON è¯·æ±‚ä½“çš„é¡¶çº§å€¼æ˜¯ä¸€ä¸ª JSON `array`(Python `list`),ä½ å¯ä»¥åœ¨å‡½æ•°å‚æ•°ä¸­å£°æ˜ç±»å‹,ä¸åœ¨ Pydantic æ¨¡å‹ä¸­ç›¸åŒ:

```python
# Python 3.9+
from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl
    name: str

@app.post("/images/multiple/")  # æ¥æ”¶å¤šä¸ªå›¾åƒçš„ç«¯ç‚¹
async def create_multiple_images(images: list[Image]):  # ç›´æ¥æ¥æ”¶å›¾åƒåˆ—è¡¨
    return images
```

### 8.1 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.8+
from typing import List

from fastapi import FastAPI
from pydantic import BaseModel, HttpUrl

app = FastAPI()

class Image(BaseModel):
    url: HttpUrl
    name: str

@app.post("/images/multiple/")
async def create_multiple_images(images: List[Image]):  # ä½¿ç”¨ List ç±»å‹
    return images
```

## 9. æ— å¤„ä¸åœ¨çš„ç¼–è¾‘å™¨æ”¯æŒ

ä½ å¯ä»¥éšå¤„è·å¾—ç¼–è¾‘å™¨æ”¯æŒ.

å³ä½¿æ˜¯åˆ—è¡¨å†…çš„é¡¹ç›®:

![ç¼–è¾‘å™¨æ”¯æŒç¤ºä¾‹](https://fastapi.tiangolo.com/img/tutorial/body-nested-models/image01.png)

å¦‚æœä½ ç›´æ¥ä½¿ç”¨ `dict` è€Œä¸æ˜¯ Pydantic æ¨¡å‹,ä½ æ— æ³•è·å¾—è¿™ç§ç¼–è¾‘å™¨æ”¯æŒ.

ä½†ä½ ä¹Ÿä¸å¿…æ‹…å¿ƒå®ƒä»¬,ä¼ å…¥çš„å­—å…¸ä¼šè¢«è‡ªåŠ¨è½¬æ¢,ä½ çš„è¾“å‡ºä¹Ÿä¼šè‡ªåŠ¨è½¬æ¢ä¸º JSON.

## 10. ä»»æ„å­—å…¸ä½“

ä½ ä¹Ÿå¯ä»¥å°†è¯·æ±‚ä½“å£°æ˜ä¸ºå…·æœ‰æŸç§ç±»å‹çš„é”®å’ŒæŸç§ç±»å‹çš„å€¼çš„ `dict`.

è¿™æ ·,ä½ ä¸å¿…äº‹å…ˆçŸ¥é“æœ‰æ•ˆçš„å­—æ®µ/å±æ€§åç§°æ˜¯ä»€ä¹ˆ(å°±åƒ Pydantic æ¨¡å‹çš„æƒ…å†µ).

å¦‚æœä½ æƒ³æ¥æ”¶ä½ å°šä¸çŸ¥é“çš„é”®,è¿™å°†å¾ˆæœ‰ç”¨.

---

å¦ä¸€ä¸ªæœ‰ç”¨çš„æ¡ˆä¾‹æ˜¯å½“ä½ æƒ³è¦å¦ä¸€ç§ç±»å‹çš„é”®(ä¾‹å¦‚,`int`)æ—¶.

è¿™å°±æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œè¦çœ‹åˆ°çš„.

åœ¨è¿™ç§æƒ…å†µä¸‹,åªè¦å®ƒå…·æœ‰å¸¦æœ‰ `float` å€¼çš„ `int` é”®,ä½ å°±ä¼šæ¥å—ä»»ä½• `dict`:

```python
# Python 3.9+
from fastapi import FastAPI

app = FastAPI()

@app.post("/index-weights/")  # æ¥æ”¶ç´¢å¼•æƒé‡
async def create_index_weights(weights: dict[int, float]):  # é”®ä¸ºæ•´æ•°,å€¼ä¸ºæµ®ç‚¹æ•°
    return weights
```

### 10.1 å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

```python
# Python 3.8+
from typing import Dict  # ä½¿ç”¨ Dict ç±»å‹

from fastapi import FastAPI

app = FastAPI()

@app.post("/index-weights/")
async def create_index_weights(weights: Dict[int, float]):  # å­—å…¸ç±»å‹æ³¨è§£
    return weights
```

**æç¤º**:è¯·è®°ä½,JSON åªæ”¯æŒ `str` ä½œä¸ºé”®.

ä½† Pydantic æœ‰è‡ªåŠ¨æ•°æ®è½¬æ¢åŠŸèƒ½.

è¿™æ„å‘³ç€,å³ä½¿ä½ çš„ API å®¢æˆ·ç«¯åªèƒ½å‘é€å­—ç¬¦ä¸²ä½œä¸ºé”®,åªè¦è¿™äº›å­—ç¬¦ä¸²åŒ…å«çº¯æ•´æ•°,Pydantic å°±ä¼šè½¬æ¢å’ŒéªŒè¯å®ƒä»¬.

è€Œä½ ä½œä¸º `weights` æ¥æ”¶åˆ°çš„ `dict` å®é™…ä¸Šå°†å…·æœ‰ `int` é”®å’Œ `float` å€¼.

## 11. æ€»ç»“

ä½¿ç”¨ FastAPI,ä½ å¯ä»¥è·å¾— Pydantic æ¨¡å‹æä¾›çš„æœ€å¤§çµæ´»æ€§,åŒæ—¶ä¿æŒä»£ç çš„ç®€å•ã€ç®€çŸ­å’Œä¼˜é›….

ä½†æ‹¥æœ‰æ‰€æœ‰å¥½å¤„:

- ç¼–è¾‘å™¨æ”¯æŒ(æ— å¤„ä¸åœ¨çš„è‡ªåŠ¨è¡¥å…¨!)
- æ•°æ®è½¬æ¢(ä¹Ÿç§°ä¸ºè§£æ/åºåˆ—åŒ–)
- æ•°æ®éªŒè¯
- æ¨¡å¼æ–‡æ¡£
- è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ
