# è¯·æ±‚è¡¨å•å’Œæ–‡ä»¶

æ‚¨å¯ä»¥åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­å®šä¹‰**æ–‡ä»¶**å’Œ**è¡¨å•å­—æ®µ**ã€‚

> **ä¿¡æ¯**
>
> è¦æ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶å’Œ/æˆ–è¡¨å•å­—æ®µï¼Œè¯·å…ˆå®‰è£… `python-multipart`ã€‚
>
> ç¡®ä¿ä½ åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæ¿€æ´»å®ƒï¼Œç„¶åå®‰è£…å®ƒï¼Œä¾‹å¦‚ï¼š
>
> ```bash
> $ pip install python-multipart
> ```
>
> è¿™æ˜¯å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä»¥"è¡¨å•æ•°æ®"çš„å½¢å¼å‘é€çš„ã€‚

## æ–‡ä»¶å’Œè¡¨å•å­—æ®µ

å£°æ˜ `File` å’Œ `Form` å‚æ•°çš„æ–¹å¼ä¸å£°æ˜ `Body` å‚æ•°çš„æ–¹å¼ç›¸åŒã€‚

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, Form, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),
        "token": token,
        "fileb_content_type": fileb.content_type,
    }
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, Form, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(
    file: Annotated[bytes, File()],
    fileb: Annotated[UploadFile, File()],
    token: Annotated[str, Form()],
):
    return {
        "file_size": len(file),
        "token": token,
        "fileb_content_type": fileb.content_type,
    }
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, Form, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(
    file: bytes = File(),
    fileb: UploadFile = File(),
    token: str = Form(),
):
    return {
        "file_size": len(file),
        "token": token,
        "fileb_content_type": fileb.content_type,
    }
```

æ–‡ä»¶å’Œè¡¨å•å­—æ®µå°†ä½œä¸º**è¡¨å•æ•°æ®**ä¸Šä¼ ï¼Œæ‚¨å°†æ¥æ”¶åˆ°æ–‡ä»¶å’Œè¡¨å•å­—æ®µã€‚

> **æ³¨æ„**
>
> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ`token` è¡¨å•å­—æ®µå°†ä½œä¸ºå­—ç¬¦ä¸²æ¥æ”¶ã€‚
>
> è¦ä»¥å­—ç¬¦ä¸²ä»¥å¤–çš„æ–¹å¼æ¥æ”¶è¡¨å•å­—æ®µï¼Œè¯·å‚é˜…[è¡¨å•æ¨¡å‹](https://fastapi.org.cn/tutorial/form-models/)ã€‚

> **è­¦å‘Š**
>
> æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª*è·¯å¾„æ“ä½œ*ä¸­å£°æ˜å¤šä¸ª `File` å’Œ `Form` å‚æ•°ï¼Œä½†æ‚¨ä¸èƒ½åŒæ—¶å£°æ˜å¸Œæœ›ä»¥ JSON å½¢å¼æ¥æ”¶çš„ `Body` å­—æ®µï¼Œå› ä¸ºè¯·æ±‚ä½“å°†ä½¿ç”¨ `multipart/form-data` è€Œä¸æ˜¯ `application/json` è¿›è¡Œç¼–ç ã€‚
>
> è¿™ä¸æ˜¯ **FastAPI** çš„é™åˆ¶ï¼Œå®ƒæ˜¯ HTTP åè®®çš„ä¸€éƒ¨åˆ†ã€‚

## å¤šä¸ªæ–‡ä»¶ä¸Šä¼ 

æ‚¨è¿˜å¯ä»¥åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ `UploadFile` åˆ—è¡¨ã€‚

### Python 3.9+

```python
from typing import Annotated, List

from fastapi import FastAPI, File, Form, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[List[UploadFile], File()],
    token: Annotated[str, Form()],
):
    return {
        "filenames": [file.filename for file in files],
        "token": token,
    }
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from typing import List

from fastapi import FastAPI, File, Form, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[List[UploadFile], File()],
    token: Annotated[str, Form()],
):
    return {
        "filenames": [file.filename for file in files],
        "token": token,
    }
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import List

from fastapi import FastAPI, File, Form, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: List[UploadFile] = File(),
    token: str = Form(),
):
    return {
        "filenames": [file.filename for file in files],
        "token": token,
    }
```

æ‚¨å°†æ”¶åˆ°ä¸€ä¸ª `UploadFile` çš„ `list`ã€‚

## æ€»ç»“

ä½¿ç”¨ `File`ã€`Form` å’Œ `UploadFile` æ¥å£°æ˜è¯·æ±‚ä¸­è¦ä¸Šä¼ çš„æ–‡ä»¶å’Œè¡¨å•å­—æ®µï¼Œè¿™äº›å°†ä½œä¸ºè¡¨å•æ•°æ®å‘é€ã€‚