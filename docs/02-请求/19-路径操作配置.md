# 路径操作配置

路径操作装饰器支持多种配置参数.

> **注意**
>
> 您可以在[高级用户指南](https://fastapi.tiangolo.com/zh/advanced/path-operation-advanced-configuration/)中了解更多高级配置.

## 路径操作装饰器参数

您可以在路径操作装饰器中配置以下参数:

### `response_model`

定义响应的模型,确保返回的数据符合指定的模式.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post("/items/", response_model=Item)
async def create_item(item: Item):
    return item
```

### `status_code`

定义响应的 HTTP 状态码.

```python
from fastapi import FastAPI, status
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post("/items/", response_model=Item, status_code=status.HTTP_201_CREATED)
async def create_item(item: Item):
    return item
```

### `tags`

添加标签到路径操作,用于在自动生成的文档中分组.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post("/items/", response_model=Item, tags=["items"])
async def create_item(item: Item):
    return item

@app.get("/items/", tags=["items"])
async def read_items():
    return [{"name": "Foo", "price": 42}]
```

### `summary` 和 `description`

添加摘要和描述到路径操作.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    description="Create an item with all the information, name, description, price, tax and a set of unique tags",
)
async def create_item(item: Item):
    return item
```

### `response_description`

添加响应描述.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post(
    "/items/",
    response_model=Item,
    summary="Create an item",
    response_description="The created item",
)
async def create_item(item: Item):
    return item
```

### `deprecated`

将路径操作标记为已弃用.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/", tags=["items"])
async def read_items():
    return [{"name": "Foo", "price": 42}]

@app.get("/users/", tags=["users"])
async def read_users():
    return [{"username": "johndoe"}]

@app.get("/elements/", tags=["items"], deprecated=True)
async def read_elements():
    return [{"item_id": "Foo"}]
```

## 使用 docstring 作为描述

您可以在路径操作函数中使用 docstring 作为描述,FastAPI 会使用它.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post("/items/", response_model=Item, summary="Create an item")
async def create_item(item: Item):
    """
    Create an item with all the information:

    - **name**: each item must have a name
    - **description**: a long description
    - **price**: required
    - **tax**: if the item doesn't have tax, you can omit this
    - **tags**: a set of unique string tags
    """
    return item
```

## 来自 OpenAPI 的响应

### `responses`

您可以添加额外的响应和示例,这些将在 OpenAPI 中显示.

```python
from fastapi import FastAPI
from fastapi.responses import JSONResponse
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None
    tags: list[str] = []

@app.post(
    "/items/",
    response_model=Item,
    responses={
        200: {
            "description": "Item requested by ID",
            "content": {
                "application/json": {
                    "example": {
                        "name": "Foo",
                        "price": 42.0,
                        "description": "The pretender",
                        "tax": 3.2,
                        "tags": ["rock", "roll", "music"],
                    }
                }
            },
        },
        404: {"description": "Item not found"},
    },
)
async def create_item(item: Item):
    return item
```

## 包含额外的媒体类型

您可以在响应中包含额外的媒体类型,如图像.

```python
from fastapi import FastAPI, Response
from fastapi.responses import JSONResponse

app = FastAPI()

@app.get("/legacy/")
def get_legacy_data():
    data = """<?xml version="1.0"?>
    <shampoo>
    <Header>
        Apply shampoo here.
    </Header>
    <Body>
        You'll have to use soap here.
    </Body>
    </shampoo>
    """
    return Response(content=data, media_type="application/xml")

@app.get("/items/{item_id}", responses={200: {"content": {"image/png": {}}}})
async def read_item(item_id: str, img: bytes | None = None):
    if img:
        return Response(content=img, media_type="image/png")
    else:
        return {"item_id": item_id}
```

## 路径操作的高级配置

您还可以进行更高级的配置,如:

### `include_in_schema`

控制是否在 OpenAPI 模式中包含此路径操作.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/", include_in_schema=False)
async def read_items():
    return [{"name": "Foo", "price": 42}]
```

### `response_class`

指定响应类,如 `HTMLResponse`、`PlainTextResponse` 等.

```python
from fastapi import FastAPI
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.get("/", response_class=HTMLResponse)
async def read_root():
    return """
    <html>
        <head>
            <title>FastAPI</title>
        </head>
        <body>
            <h1>Hello World</h1>
        </body>
    </html>
    """
```

### `name` 和 `operation_id`

自定义 OpenAPI 中的操作 ID.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/", operation_id="get_items_list")
async def read_items():
    return [{"name": "Foo", "price": 42}]
```

## 总结

路径操作装饰器提供了多种配置参数,让您可以:

- 定义响应模型和状态码
- 添加标签、摘要和描述
- 标记已弃用的操作
- 自定义 OpenAPI 中的响应
- 包含额外的媒体类型
- 控制是否包含在模式中
- 指定响应类
- 自定义操作 ID