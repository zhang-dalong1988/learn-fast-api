# è¯·æ±‚æ–‡ä»¶

æ‚¨å¯ä»¥ä½¿ç”¨ `File` æ¥å®šä¹‰ç”±å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶ã€‚

> **ä¿¡æ¯**
>
> è¦æ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¯·å…ˆå®‰è£… `python-multipart`ã€‚
>
> ç¡®ä¿ä½ åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæ¿€æ´»å®ƒï¼Œç„¶åå®‰è£…å®ƒï¼Œä¾‹å¦‚ï¼š
>
> ```bash
> $ pip install python-multipart
> ```
>
> è¿™æ˜¯å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä»¥"è¡¨å•æ•°æ®"çš„å½¢å¼å‘é€çš„ã€‚

## å¯¼å…¥ `File`

ä» `fastapi` å¯¼å…¥ `File` å’Œ `UploadFile`

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

## å®šä¹‰ `File` å‚æ•°

åˆ›å»ºæ–‡ä»¶å‚æ•°çš„æ–¹å¼ä¸ä¸º `Body` æˆ– `Form` åˆ›å»ºå‚æ•°çš„æ–¹å¼ç›¸åŒ

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **ä¿¡æ¯**
>
> `File` æ˜¯ä¸€ä¸ªç›´æ¥ç»§æ‰¿è‡ª `Form` çš„ç±»ã€‚
>
> ä½†è¯·è®°ä½ï¼Œå½“æ‚¨ä» `fastapi` å¯¼å…¥ `Query`ã€`Path`ã€`File` ç­‰æ—¶ï¼Œè¿™äº›å®é™…ä¸Šæ˜¯è¿”å›ç‰¹æ®Šç±»çš„å‡½æ•°ã€‚

> **æç¤º**
>
> è¦å£°æ˜æ–‡ä»¶ä½“ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ `File`ï¼Œå¦åˆ™å‚æ•°å°†è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°æˆ–è¯·æ±‚ä½“ï¼ˆJSONï¼‰å‚æ•°ã€‚
>
> æ–‡ä»¶å°†ä½œä¸º"è¡¨å•æ•°æ®"ä¸Šä¼ ã€‚
>
> å¦‚æœæ‚¨å°†*è·¯å¾„æ“ä½œå‡½æ•°*å‚æ•°çš„ç±»å‹å£°æ˜ä¸º `bytes`ï¼Œ**FastAPI** å°†ä¸ºæ‚¨è¯»å–æ–‡ä»¶ï¼Œæ‚¨å°†ä»¥ `bytes` çš„å½¢å¼æ¥æ”¶æ–‡ä»¶å†…å®¹ã€‚
>
> è¯·è®°ä½ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªæ–‡ä»¶å†…å®¹å°†è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™å¯¹äºå°æ–‡ä»¶æ¥è¯´æ•ˆæœå¾ˆå¥½ã€‚
>
> ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `UploadFile` å¯èƒ½ä¼šæ›´æœ‰ç›Šã€‚

## å¸¦ `UploadFile` çš„æ–‡ä»¶å‚æ•°

ä½¿ç”¨ `UploadFile` ç±»å‹å®šä¹‰ä¸€ä¸ªæ–‡ä»¶å‚æ•°

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

ä¸ `bytes` ç›¸æ¯”ï¼Œä½¿ç”¨ `UploadFile` æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š

- æ‚¨ä¸å¿…åœ¨å‚æ•°çš„é»˜è®¤å€¼ä¸­ä½¿ç”¨ `File()`ã€‚
- å®ƒä½¿ç”¨ä¸€ä¸ª"spooled"æ–‡ä»¶
  - æ–‡ä»¶è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°è¾¾åˆ°ä¸€ä¸ªæœ€å¤§å¤§å°é™åˆ¶ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶åï¼Œå®ƒå°†è¢«å­˜å‚¨åœ¨ç£ç›˜ä¸­ã€‚
- è¿™æ„å‘³ç€å®ƒå¯¹äºå¤§æ–‡ä»¶ï¼ˆå¦‚å›¾åƒã€è§†é¢‘ã€å¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ï¼‰ä¼šå¾ˆå¥½åœ°å·¥ä½œï¼Œè€Œä¸ä¼šæ¶ˆè€—æ‰€æœ‰å†…å­˜ã€‚
- æ‚¨å¯ä»¥ä»ä¸Šä¼ çš„æ–‡ä»¶ä¸­è·å–å…ƒæ•°æ®ã€‚
- å®ƒæœ‰ä¸€ä¸ªç±»æ–‡ä»¶ï¼ˆfile-likeï¼‰çš„ `async` æ¥å£ã€‚
- å®ƒæš´éœ²äº†ä¸€ä¸ªå®é™…çš„ Python `SpooledTemporaryFile` å¯¹è±¡ï¼Œæ‚¨å¯ä»¥å°†å…¶ç›´æ¥ä¼ é€’ç»™å…¶ä»–æœŸæœ›ä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡çš„åº“ã€‚

### `UploadFile`

`UploadFile` å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

- `filename`ï¼šä¸€ä¸ª `str`ï¼ŒåŒ…å«ä¸Šä¼ çš„åŸå§‹æ–‡ä»¶åï¼ˆä¾‹å¦‚ `myimage.jpg`ï¼‰ã€‚
- `content_type`ï¼šä¸€ä¸ª `str`ï¼ŒåŒ…å«å†…å®¹ç±»å‹ï¼ˆMIME ç±»å‹ / åª’ä½“ç±»å‹ï¼‰ï¼ˆä¾‹å¦‚ `image/jpeg`ï¼‰ã€‚
- `file`ï¼šä¸€ä¸ª `SpooledTemporaryFile`ï¼ˆä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡ï¼‰ã€‚è¿™æ˜¯å®é™…çš„ Python æ–‡ä»¶å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ç›´æ¥å°†å…¶ä¼ é€’ç»™å…¶ä»–æœŸæœ›ä¸€ä¸ª"ç±»æ–‡ä»¶"å¯¹è±¡çš„å‡½æ•°æˆ–åº“ã€‚

`UploadFile` æœ‰ä»¥ä¸‹ `async` æ–¹æ³•ã€‚å®ƒä»¬éƒ½åœ¨åº•å±‚è°ƒç”¨ç›¸åº”çš„æ–‡ä»¶æ–¹æ³•ï¼ˆä½¿ç”¨å†…éƒ¨çš„ `SpooledTemporaryFile`ï¼‰ï¼š

- `write(data)`ï¼šå°† `data`ï¼ˆ`str` æˆ– `bytes`ï¼‰å†™å…¥æ–‡ä»¶ã€‚
- `read(size)`ï¼šè¯»å–æ–‡ä»¶çš„ `size`ï¼ˆ`int`ï¼‰ä¸ªå­—èŠ‚/å­—ç¬¦ã€‚
- `seek(offset)`ï¼šç§»åŠ¨åˆ°æ–‡ä»¶ä¸­çš„å­—èŠ‚ä½ç½® `offset` (`int`)ã€‚
  - ä¾‹å¦‚ï¼Œ`await myfile.seek(0)` å°†ä¼šç§»åŠ¨åˆ°æ–‡ä»¶çš„å¼€å¤´ã€‚
  - å¦‚æœæ‚¨è¿è¡Œäº†ä¸€æ¬¡ `await myfile.read()`ï¼Œç„¶åéœ€è¦å†æ¬¡è¯»å–å†…å®¹ï¼Œè¿™ä¼šç‰¹åˆ«æœ‰ç”¨ã€‚
- `close()`ï¼šå…³é—­æ–‡ä»¶ã€‚

ç”±äºæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯ `async` æ–¹æ³•ï¼Œæ‚¨éœ€è¦"await"å®ƒä»¬ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª `async` *è·¯å¾„æ“ä½œå‡½æ•°*ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å†…å®¹ï¼š

```python
contents = await myfile.read()
```

å¦‚æœæ‚¨åœ¨ä¸€ä¸ªæ™®é€šçš„ `def` *è·¯å¾„æ“ä½œå‡½æ•°*ä¸­ï¼Œæ‚¨å¯ä»¥ç›´æ¥è®¿é—® `UploadFile.file`ï¼Œä¾‹å¦‚ï¼š

```python
contents = myfile.file.read()
```

> `async` æŠ€æœ¯ç»†èŠ‚
>
> å½“æ‚¨ä½¿ç”¨ `async` æ–¹æ³•æ—¶ï¼Œ**FastAPI** ä¼šåœ¨ä¸€ä¸ªçº¿ç¨‹æ± ä¸­è¿è¡Œæ–‡ä»¶æ–¹æ³•å¹¶ç­‰å¾…å®ƒä»¬ã€‚

> Starlette æŠ€æœ¯ç»†èŠ‚
>
> **FastAPI** çš„ `UploadFile` ç›´æ¥ç»§æ‰¿è‡ª **Starlette** çš„ `UploadFile`ï¼Œä½†å¢åŠ äº†ä¸€äº›å¿…è¦çš„éƒ¨åˆ†ï¼Œä½¿å…¶ä¸ **Pydantic** å’Œ FastAPI çš„å…¶ä»–éƒ¨åˆ†å…¼å®¹ã€‚

## ä»€ä¹ˆæ˜¯"è¡¨å•æ•°æ®"

HTML è¡¨å• (`<form></form>`) å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨çš„æ–¹å¼é€šå¸¸å¯¹æ•°æ®ä½¿ç”¨ä¸€ç§"ç‰¹æ®Š"çš„ç¼–ç ï¼Œå®ƒä¸ JSON ä¸åŒã€‚

**FastAPI** ä¼šç¡®ä¿ä»æ­£ç¡®çš„åœ°æ–¹è¯»å–æ•°æ®ï¼Œè€Œä¸æ˜¯ä» JSON ä¸­è¯»å–ã€‚

> æŠ€æœ¯ç»†èŠ‚
>
> å½“è¡¨å•æ•°æ®ä¸åŒ…å«æ–‡ä»¶æ—¶ï¼Œé€šå¸¸ä½¿ç”¨"åª’ä½“ç±»å‹"`application/x-www-form-urlencoded` è¿›è¡Œç¼–ç ã€‚
>
> ä½†æ˜¯å½“è¡¨å•åŒ…å«æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè¢«ç¼–ç ä¸º `multipart/form-data`ã€‚å¦‚æœæ‚¨ä½¿ç”¨ `File`ï¼Œ**FastAPI** ä¼šçŸ¥é“å®ƒå¿…é¡»ä»è¯·æ±‚ä½“çš„æ­£ç¡®éƒ¨åˆ†è·å–æ–‡ä»¶ã€‚
>
> å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºè¿™äº›ç¼–ç å’Œè¡¨å•å­—æ®µçš„ä¿¡æ¯ï¼Œè¯·æŸ¥é˜… MDN å…³äº `POST` çš„ç½‘ç»œæ–‡æ¡£ã€‚

> **è­¦å‘Š**
>
> æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª*è·¯å¾„æ“ä½œ*ä¸­å£°æ˜å¤šä¸ª `File` å’Œ `Form` å‚æ•°ï¼Œä½†æ‚¨ä¸èƒ½åŒæ—¶å£°æ˜å¸Œæœ›ä»¥ JSON å½¢å¼æ¥æ”¶çš„ `Body` å­—æ®µï¼Œå› ä¸ºè¯·æ±‚ä½“å°†ä½¿ç”¨ `multipart/form-data` è€Œä¸æ˜¯ `application/json` è¿›è¡Œç¼–ç ã€‚
>
> è¿™ä¸æ˜¯ **FastAPI** çš„é™åˆ¶ï¼Œå®ƒæ˜¯ HTTP åè®®çš„ä¸€éƒ¨åˆ†ã€‚

## å¯é€‰æ–‡ä»¶ä¸Šä¼ 

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨æ ‡å‡†çš„ç±»å‹æ³¨è§£å¹¶å°†é»˜è®¤å€¼è®¾ç½®ä¸º `None` æ¥ä½¿æ–‡ä»¶ä¸Šä¼ æˆä¸ºå¯é€‰çš„

### Python 3.10+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes | None, File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile | None = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.9+ - é Annotated

```python
from typing import Annotated, Union

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[Union[bytes, None], File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

#### Python 3.8+ - é Annotated

```python
from typing import Union

from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[Union[bytes, None], File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes | None = File(default=None)):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile | None = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import Union

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Union[bytes, None] = File(default=None)):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

## å¸¦é¢å¤–å…ƒæ•°æ®çš„ `UploadFile`

æ‚¨ä¹Ÿå¯ä»¥å°† `File()`ä¸ `UploadFile` ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®é¢å¤–çš„å…ƒæ•°æ®

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File(description="A file read as bytes")]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: Annotated[UploadFile, File(description="A file read as UploadFile")],
):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File(description="A file read as bytes")]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: Annotated[UploadFile, File(description="A file read as UploadFile")],
):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File(description="A file read as bytes")):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: UploadFile = File(description="A file read as UploadFile"),
):
    return {"filename": file.filename}
```

## å¤šæ–‡ä»¶ä¸Šä¼ 

å¯ä»¥åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚

å®ƒä»¬å°†ä¸ä½¿ç”¨"è¡¨å•æ•°æ®"å‘é€çš„åŒä¸€ä¸ª"è¡¨å•å­—æ®µ"ç›¸å…³è”ã€‚

è¦ä½¿ç”¨å®ƒï¼Œè¯·å£°æ˜ä¸€ä¸ª `bytes` æˆ– `UploadFile` çš„åˆ—è¡¨

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: Annotated[list[bytes], File()]):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: list[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_files(files: Annotated[List[bytes], File()]):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: List[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: list[bytes] = File()):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: list[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: List[bytes] = File()):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: List[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

æ‚¨å°†æ”¶åˆ°ä¸€ä¸ªå£°æ˜çš„ `bytes` æˆ– `UploadFile` çš„ `list`ã€‚

> æŠ€æœ¯ç»†èŠ‚
>
> æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `from starlette.responses import HTMLResponse`ã€‚
>
> **FastAPI** æä¾›ä¸ `fastapi.responses` ç›¸åŒçš„ `starlette.responses` åªæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…ã€‚ä½†å¤§å¤šæ•°å¯ç”¨çš„å“åº”ç›´æ¥æ¥è‡ª Starletteã€‚

### å¸¦é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ 

ä¸ä¹‹å‰ä¸€æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `File()` æ¥è®¾ç½®é¢å¤–çš„å‚æ•°ï¼Œå³ä½¿æ˜¯å¯¹äº `UploadFile`

#### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[list[bytes], File(description="Multiple files as bytes")],
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: Annotated[
        list[UploadFile], File(description="Multiple files as UploadFile")
    ],
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[List[bytes], File(description="Multiple files as bytes")],
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: Annotated[
        List[UploadFile], File(description="Multiple files as UploadFile")
    ],
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: list[bytes] = File(description="Multiple files as bytes"),
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: list[UploadFile] = File(description="Multiple files as UploadFile"),
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬ã€‚

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: List[bytes] = File(description="Multiple files as bytes"),
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: List[UploadFile] = File(description="Multiple files as UploadFile"),
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

## æ€»ç»“

ä½¿ç”¨ `File`ã€`bytes` å’Œ `UploadFile` æ¥å£°æ˜è¯·æ±‚ä¸­è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°†ä½œä¸ºè¡¨å•æ•°æ®å‘é€ã€‚