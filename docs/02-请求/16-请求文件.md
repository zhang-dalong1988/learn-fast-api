# è¯·æ±‚æ–‡ä»¶

æ‚¨å¯ä»¥ä½¿ç”¨ `File` æ¥å®šä¹‰ç”±å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶.

> **ä¿¡æ¯**
>
> è¦æ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶,è¯·å…ˆå®‰è£… `python-multipart`.
>
> ç¡®ä¿ä½ åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ,æ¿€æ´»å®ƒ,ç„¶åå®‰è£…å®ƒ,ä¾‹å¦‚:
>
> ```bash
> $ pip install python-multipart
> ```
>
> è¿™æ˜¯å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä»¥"è¡¨å•æ•°æ®"çš„å½¢å¼å‘é€çš„.

## å¯¼å…¥ `File`

ä» `fastapi` å¯¼å…¥ `File` å’Œ `UploadFile`

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

## å®šä¹‰ `File` å‚æ•°

åˆ›å»ºæ–‡ä»¶å‚æ•°çš„æ–¹å¼ä¸ä¸º `Body` æˆ– `Form` åˆ›å»ºå‚æ•°çš„æ–¹å¼ç›¸åŒ

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **ä¿¡æ¯**
>
> `File` æ˜¯ä¸€ä¸ªç›´æ¥ç»§æ‰¿è‡ª `Form` çš„ç±».
>
> ä½†è¯·è®°ä½,å½“æ‚¨ä» `fastapi` å¯¼å…¥ `Query`ã€`Path`ã€`File` ç­‰æ—¶,è¿™äº›å®é™…ä¸Šæ˜¯è¿”å›ç‰¹æ®Šç±»çš„å‡½æ•°.

> **æç¤º**
>
> è¦å£°æ˜æ–‡ä»¶ä½“,æ‚¨éœ€è¦ä½¿ç”¨ `File`,å¦åˆ™å‚æ•°å°†è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°æˆ–è¯·æ±‚ä½“(JSON)å‚æ•°.
>
> æ–‡ä»¶å°†ä½œä¸º"è¡¨å•æ•°æ®"ä¸Šä¼ .
>
> å¦‚æœæ‚¨å°†*è·¯å¾„æ“ä½œå‡½æ•°*å‚æ•°çš„ç±»å‹å£°æ˜ä¸º `bytes`,**FastAPI** å°†ä¸ºæ‚¨è¯»å–æ–‡ä»¶,æ‚¨å°†ä»¥ `bytes` çš„å½¢å¼æ¥æ”¶æ–‡ä»¶å†…å®¹.
>
> è¯·è®°ä½,è¿™æ„å‘³ç€æ•´ä¸ªæ–‡ä»¶å†…å®¹å°†è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­.è¿™å¯¹äºå°æ–‡ä»¶æ¥è¯´æ•ˆæœå¾ˆå¥½.
>
> ä½†åœ¨æŸäº›æƒ…å†µä¸‹,ä½¿ç”¨ `UploadFile` å¯èƒ½ä¼šæ›´æœ‰ç›Š.

## å¸¦ `UploadFile` çš„æ–‡ä»¶å‚æ•°

ä½¿ç”¨ `UploadFile` ç±»å‹å®šä¹‰ä¸€ä¸ªæ–‡ä»¶å‚æ•°

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File()]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File()):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile):
    return {"filename": file.filename}
```

ä¸ `bytes` ç›¸æ¯”,ä½¿ç”¨ `UploadFile` æœ‰å‡ ä¸ªä¼˜ç‚¹:

- æ‚¨ä¸å¿…åœ¨å‚æ•°çš„é»˜è®¤å€¼ä¸­ä½¿ç”¨ `File()`.
- å®ƒä½¿ç”¨ä¸€ä¸ª"spooled"æ–‡ä»¶
  - æ–‡ä»¶è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­,ç›´åˆ°è¾¾åˆ°ä¸€ä¸ªæœ€å¤§å¤§å°é™åˆ¶,è¶…è¿‡è¿™ä¸ªé™åˆ¶å,å®ƒå°†è¢«å­˜å‚¨åœ¨ç£ç›˜ä¸­.
- è¿™æ„å‘³ç€å®ƒå¯¹äºå¤§æ–‡ä»¶(å¦‚å›¾åƒã€è§†é¢‘ã€å¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶ç­‰)ä¼šå¾ˆå¥½åœ°å·¥ä½œ,è€Œä¸ä¼šæ¶ˆè€—æ‰€æœ‰å†…å­˜.
- æ‚¨å¯ä»¥ä»ä¸Šä¼ çš„æ–‡ä»¶ä¸­è·å–å…ƒæ•°æ®.
- å®ƒæœ‰ä¸€ä¸ªç±»æ–‡ä»¶(file-like)çš„ `async` æ¥å£.
- å®ƒæš´éœ²äº†ä¸€ä¸ªå®é™…çš„ Python `SpooledTemporaryFile` å¯¹è±¡,æ‚¨å¯ä»¥å°†å…¶ç›´æ¥ä¼ é€’ç»™å…¶ä»–æœŸæœ›ä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡çš„åº“.

### `UploadFile`

`UploadFile` å…·æœ‰ä»¥ä¸‹å±æ€§:

- `filename`:ä¸€ä¸ª `str`,åŒ…å«ä¸Šä¼ çš„åŸå§‹æ–‡ä»¶å(ä¾‹å¦‚ `myimage.jpg`).
- `content_type`:ä¸€ä¸ª `str`,åŒ…å«å†…å®¹ç±»å‹(MIME ç±»å‹ / åª’ä½“ç±»å‹)(ä¾‹å¦‚ `image/jpeg`).
- `file`:ä¸€ä¸ª `SpooledTemporaryFile`(ä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡).è¿™æ˜¯å®é™…çš„ Python æ–‡ä»¶å¯¹è±¡,æ‚¨å¯ä»¥ç›´æ¥å°†å…¶ä¼ é€’ç»™å…¶ä»–æœŸæœ›ä¸€ä¸ª"ç±»æ–‡ä»¶"å¯¹è±¡çš„å‡½æ•°æˆ–åº“.

`UploadFile` æœ‰ä»¥ä¸‹ `async` æ–¹æ³•.å®ƒä»¬éƒ½åœ¨åº•å±‚è°ƒç”¨ç›¸åº”çš„æ–‡ä»¶æ–¹æ³•(ä½¿ç”¨å†…éƒ¨çš„ `SpooledTemporaryFile`):

- `write(data)`:å°† `data`(`str` æˆ– `bytes`)å†™å…¥æ–‡ä»¶.
- `read(size)`:è¯»å–æ–‡ä»¶çš„ `size`(`int`)ä¸ªå­—èŠ‚/å­—ç¬¦.
- `seek(offset)`:ç§»åŠ¨åˆ°æ–‡ä»¶ä¸­çš„å­—èŠ‚ä½ç½® `offset` (`int`).
  - ä¾‹å¦‚,`await myfile.seek(0)` å°†ä¼šç§»åŠ¨åˆ°æ–‡ä»¶çš„å¼€å¤´.
  - å¦‚æœæ‚¨è¿è¡Œäº†ä¸€æ¬¡ `await myfile.read()`,ç„¶åéœ€è¦å†æ¬¡è¯»å–å†…å®¹,è¿™ä¼šç‰¹åˆ«æœ‰ç”¨.
- `close()`:å…³é—­æ–‡ä»¶.

ç”±äºæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯ `async` æ–¹æ³•,æ‚¨éœ€è¦"await"å®ƒä»¬.

ä¾‹å¦‚,åœ¨ä¸€ä¸ª `async` *è·¯å¾„æ“ä½œå‡½æ•°*ä¸­,æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å†…å®¹:

```python
contents = await myfile.read()
```

å¦‚æœæ‚¨åœ¨ä¸€ä¸ªæ™®é€šçš„ `def` *è·¯å¾„æ“ä½œå‡½æ•°*ä¸­,æ‚¨å¯ä»¥ç›´æ¥è®¿é—® `UploadFile.file`,ä¾‹å¦‚:

```python
contents = myfile.file.read()
```

> `async` æŠ€æœ¯ç»†èŠ‚
>
> å½“æ‚¨ä½¿ç”¨ `async` æ–¹æ³•æ—¶,**FastAPI** ä¼šåœ¨ä¸€ä¸ªçº¿ç¨‹æ± ä¸­è¿è¡Œæ–‡ä»¶æ–¹æ³•å¹¶ç­‰å¾…å®ƒä»¬.

> Starlette æŠ€æœ¯ç»†èŠ‚
>
> **FastAPI** çš„ `UploadFile` ç›´æ¥ç»§æ‰¿è‡ª **Starlette** çš„ `UploadFile`,ä½†å¢åŠ äº†ä¸€äº›å¿…è¦çš„éƒ¨åˆ†,ä½¿å…¶ä¸ **Pydantic** å’Œ FastAPI çš„å…¶ä»–éƒ¨åˆ†å…¼å®¹.

## ä»€ä¹ˆæ˜¯"è¡¨å•æ•°æ®"

HTML è¡¨å• (`<form></form>`) å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨çš„æ–¹å¼é€šå¸¸å¯¹æ•°æ®ä½¿ç”¨ä¸€ç§"ç‰¹æ®Š"çš„ç¼–ç ,å®ƒä¸ JSON ä¸åŒ.

**FastAPI** ä¼šç¡®ä¿ä»æ­£ç¡®çš„åœ°æ–¹è¯»å–æ•°æ®,è€Œä¸æ˜¯ä» JSON ä¸­è¯»å–.

> æŠ€æœ¯ç»†èŠ‚
>
> å½“è¡¨å•æ•°æ®ä¸åŒ…å«æ–‡ä»¶æ—¶,é€šå¸¸ä½¿ç”¨"åª’ä½“ç±»å‹"`application/x-www-form-urlencoded` è¿›è¡Œç¼–ç .
>
> ä½†æ˜¯å½“è¡¨å•åŒ…å«æ–‡ä»¶æ—¶,å®ƒä¼šè¢«ç¼–ç ä¸º `multipart/form-data`.å¦‚æœæ‚¨ä½¿ç”¨ `File`,**FastAPI** ä¼šçŸ¥é“å®ƒå¿…é¡»ä»è¯·æ±‚ä½“çš„æ­£ç¡®éƒ¨åˆ†è·å–æ–‡ä»¶.
>
> å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºè¿™äº›ç¼–ç å’Œè¡¨å•å­—æ®µçš„ä¿¡æ¯,è¯·æŸ¥é˜… MDN å…³äº `POST` çš„ç½‘ç»œæ–‡æ¡£.

> **è­¦å‘Š**
>
> æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª*è·¯å¾„æ“ä½œ*ä¸­å£°æ˜å¤šä¸ª `File` å’Œ `Form` å‚æ•°,ä½†æ‚¨ä¸èƒ½åŒæ—¶å£°æ˜å¸Œæœ›ä»¥ JSON å½¢å¼æ¥æ”¶çš„ `Body` å­—æ®µ,å› ä¸ºè¯·æ±‚ä½“å°†ä½¿ç”¨ `multipart/form-data` è€Œä¸æ˜¯ `application/json` è¿›è¡Œç¼–ç .
>
> è¿™ä¸æ˜¯ **FastAPI** çš„é™åˆ¶,å®ƒæ˜¯ HTTP åè®®çš„ä¸€éƒ¨åˆ†.

## å¯é€‰æ–‡ä»¶ä¸Šä¼ 

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨æ ‡å‡†çš„ç±»å‹æ³¨è§£å¹¶å°†é»˜è®¤å€¼è®¾ç½®ä¸º `None` æ¥ä½¿æ–‡ä»¶ä¸Šä¼ æˆä¸ºå¯é€‰çš„

### Python 3.10+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes | None, File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile | None = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.9+ - é Annotated

```python
from typing import Annotated, Union

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[Union[bytes, None], File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

#### Python 3.8+ - é Annotated

```python
from typing import Union

from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[Union[bytes, None], File()] = None):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes | None = File(default=None)):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: UploadFile | None = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import Union

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Union[bytes, None] = File(default=None)):
    if not file:
        return {"message": "No file sent"}
    else:
        return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(file: Union[UploadFile, None] = None):
    if not file:
        return {"message": "No upload file sent"}
    else:
        return {"filename": file.filename}
```

## å¸¦é¢å¤–å…ƒæ•°æ®çš„ `UploadFile`

æ‚¨ä¹Ÿå¯ä»¥å°† `File()`ä¸ `UploadFile` ä¸€èµ·ä½¿ç”¨,ä¾‹å¦‚,è®¾ç½®é¢å¤–çš„å…ƒæ•°æ®

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File(description="A file read as bytes")]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: Annotated[UploadFile, File(description="A file read as UploadFile")],
):
    return {"filename": file.filename}
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from fastapi import FastAPI, File, UploadFile
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_file(file: Annotated[bytes, File(description="A file read as bytes")]):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: Annotated[UploadFile, File(description="A file read as UploadFile")],
):
    return {"filename": file.filename}
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile

app = FastAPI()

@app.post("/files/")
async def create_file(file: bytes = File(description="A file read as bytes")):
    return {"file_size": len(file)}

@app.post("/uploadfile/")
async def create_upload_file(
    file: UploadFile = File(description="A file read as UploadFile"),
):
    return {"filename": file.filename}
```

## å¤šæ–‡ä»¶ä¸Šä¼ 

å¯ä»¥åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶.

å®ƒä»¬å°†ä¸ä½¿ç”¨"è¡¨å•æ•°æ®"å‘é€çš„åŒä¸€ä¸ª"è¡¨å•å­—æ®µ"ç›¸å…³è”.

è¦ä½¿ç”¨å®ƒ,è¯·å£°æ˜ä¸€ä¸ª `bytes` æˆ– `UploadFile` çš„åˆ—è¡¨

### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: Annotated[list[bytes], File()]):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: list[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_files(files: Annotated[List[bytes], File()]):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: List[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: list[bytes] = File()):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: list[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(files: List[bytes] = File()):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(files: List[UploadFile]):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

æ‚¨å°†æ”¶åˆ°ä¸€ä¸ªå£°æ˜çš„ `bytes` æˆ– `UploadFile` çš„ `list`.

> æŠ€æœ¯ç»†èŠ‚
>
> æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `from starlette.responses import HTMLResponse`.
>
> **FastAPI** æä¾›ä¸ `fastapi.responses` ç›¸åŒçš„ `starlette.responses` åªæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€….ä½†å¤§å¤šæ•°å¯ç”¨çš„å“åº”ç›´æ¥æ¥è‡ª Starlette.

### å¸¦é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ 

ä¸ä¹‹å‰ä¸€æ ·,æ‚¨å¯ä»¥ä½¿ç”¨ `File()` æ¥è®¾ç½®é¢å¤–çš„å‚æ•°,å³ä½¿æ˜¯å¯¹äº `UploadFile`

#### Python 3.9+

```python
from typing import Annotated

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[list[bytes], File(description="Multiple files as bytes")],
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: Annotated[
        list[UploadFile], File(description="Multiple files as UploadFile")
    ],
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> ğŸ¤“ å…¶ä»–ç‰ˆæœ¬å’Œå˜ä½“

#### Python 3.8+ - é Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse
from typing_extensions import Annotated

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: Annotated[List[bytes], File(description="Multiple files as bytes")],
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: Annotated[
        List[UploadFile], File(description="Multiple files as UploadFile")
    ],
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.9+ - ä¸ä½¿ç”¨ Annotated

```python
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: list[bytes] = File(description="Multiple files as bytes"),
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: list[UploadFile] = File(description="Multiple files as UploadFile"),
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

> **æç¤º**
>
> å¦‚æœå¯èƒ½,è¯·ä¼˜å…ˆä½¿ç”¨ `Annotated` ç‰ˆæœ¬.

#### Python 3.8+ - ä¸ä½¿ç”¨ Annotated

```python
from typing import List

from fastapi import FastAPI, File, UploadFile
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.post("/files/")
async def create_files(
    files: List[bytes] = File(description="Multiple files as bytes"),
):
    return {"file_sizes": [len(file) for file in files]}

@app.post("/uploadfiles/")
async def create_upload_files(
    files: List[UploadFile] = File(description="Multiple files as UploadFile"),
):
    return {"filenames": [file.filename for file in files]}

@app.get("/")
async def main():
    content = """
<body>
<form action="/files/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
<form action="/uploadfiles/" enctype="multipart/form-data" method="post">
<input name="files" type="file" multiple>
<input type="submit">
</form>
</body>
    """
    return HTMLResponse(content=content)
```

## æ€»ç»“

ä½¿ç”¨ `File`ã€`bytes` å’Œ `UploadFile` æ¥å£°æ˜è¯·æ±‚ä¸­è¦ä¸Šä¼ çš„æ–‡ä»¶,è¿™äº›æ–‡ä»¶å°†ä½œä¸ºè¡¨å•æ•°æ®å‘é€.